<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tez Earn Money</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    
    
    <style>
        /* Professional Premium 3D Wheel Styling */
        .wheel-container { 
            position: relative; 
            width: 260px; 
            height: 260px; 
            margin: 20px auto;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.3));
        }
        @media (max-width: 380px) {
            .wheel-container {
                width: 240px;
                height: 240px;
            }
        }
        
        /* Simple Red Arrow Pointer */
        .wheel-pointer { 
            position: absolute; 
            top: -10px; 
            left: 50%; 
            transform: translateX(-50%); 
            z-index: 30;
            animation: arrowPulse 2s ease-in-out infinite;
        }
        
        @keyframes arrowPulse {
            0%, 100% { 
                transform: translateX(-50%) translateY(0px); 
                filter: drop-shadow(0 4px 8px rgba(220, 20, 60, 0.5));
            }
            50% { 
                transform: translateX(-50%) translateY(-3px); 
                filter: drop-shadow(0 6px 12px rgba(220, 20, 60, 0.7));
            }
        }
        
        .arrow-body {
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 30px solid #DC143C;
            filter: drop-shadow(0 4px 8px rgba(220, 20, 60, 0.4));
        }
        
        /* Professional 3D Wheel with Perfect Segments */
        .wheel { 
            width: 100%; 
            height: 100%; 
            border-radius: 50%; 
            position: relative;
            transition: transform 4s cubic-bezier(0.2, 0.8, 0.3, 0.95); 
            transform-style: preserve-3d;
        }
        
        
        /* Inner White Ring */
        .wheel::after {
            content: '';
            position: absolute;
            top: -5px;
            left: -5px;
            right: -5px;
            bottom: -5px;
            background: white;
            border-radius: 50%;
            z-index: -1;
            box-shadow: 0 0 25px rgba(0,0,0,0.2);
        }
        
        /* SVG Wheel Canvas */
        .wheel-svg {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            box-shadow: 
                0 0 0 5px rgba(255,255,255,0.8),
                0 20px 40px rgba(0,0,0,0.3),
                inset 0 5px 20px rgba(255,255,255,0.5);
        }
        
        /* Segment Styling */
        .wheel-segment {
            transition: opacity 0.2s;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.2));
        }
        
        .wheel-segment:hover {
            opacity: 0.9;
        }
        
        /* Segment Text Styling */
        .segment-text {
            font-family: 'Arial Black', sans-serif;
            font-weight: 900;
            font-size: 28px;
            fill: #1a1a2e;
            stroke: #ffffff;
            stroke-width: 2;
            paint-order: stroke fill;
            text-shadow: 
                0 2px 4px rgba(0,0,0,0.3),
                0 1px 2px rgba(0,0,0,0.2);
            letter-spacing: 1px;
        }
        
        @media (max-width: 380px) {
            .segment-text {
                font-size: 24px;
            }
        }
        
        /* Segment Border Lines */
        .segment-divider {
            stroke: rgba(255, 255, 255, 0.4);
            stroke-width: 2;
            filter: drop-shadow(0 0 3px rgba(255, 215, 0, 0.4));
        }
        
        /* Premium Stationary Center Circle - Does not rotate with wheel */
        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 55px;
            height: 55px;
            background: 
                linear-gradient(135deg, #667eea 0%, #764ba2 100%),
                radial-gradient(circle at 30% 30%, rgba(255,255,255,0.3) 0%, transparent 70%);
            border-radius: 50%;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 0 0 6px #ffffff,
                0 0 0 9px rgba(102, 126, 234, 0.3),
                0 0 20px rgba(102, 126, 234, 0.5),
                inset 0 2px 8px rgba(255,255,255,0.4),
                inset 0 -2px 8px rgba(0,0,0,0.25);
            animation: centerPulse 3s ease-in-out infinite;
        }
        @keyframes centerPulse {
            0%, 100% { 
                box-shadow: 
                    0 0 0 6px #ffffff,
                    0 0 0 9px rgba(102, 126, 234, 0.3),
                    0 0 20px rgba(102, 126, 234, 0.5),
                    inset 0 2px 8px rgba(255,255,255,0.4),
                    inset 0 -2px 8px rgba(0,0,0,0.25);
            }
            50% { 
                box-shadow: 
                    0 0 0 6px #ffffff,
                    0 0 0 9px rgba(102, 126, 234, 0.5),
                    0 0 30px rgba(102, 126, 234, 0.7),
                    inset 0 2px 8px rgba(255,255,255,0.4),
                    inset 0 -2px 8px rgba(0,0,0,0.25);
            }
        }
        @media (max-width: 380px) {
            .wheel-center {
                width: 50px;
                height: 50px;
            }
        }
        
        /* Premium Sparkle Effects */
        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            border-radius: 50%;
            animation: sparkle 2s infinite;
            z-index: 4;
            box-shadow: 0 0 8px rgba(255,215,0,0.8);
        }
        
        @keyframes sparkle {
            0%, 100% { 
                opacity: 0; 
                transform: scale(0) rotate(0deg); 
            }
            50% { 
                opacity: 1; 
                transform: scale(1.5) rotate(180deg); 
            }
        }
        
        /* Section Styling */
        .auth-section { 
            display: none; 
            animation: fadeIn 0.5s ease-in;
        }
        .auth-section.active { 
            display: block; 
        }
        
        .app-section { 
            display: none; 
            animation: fadeIn 0.5s ease-in;
        }
        .app-section.active { 
            display: block; 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Notification Animation */
        .notification-item { 
            transition: all 0.3s ease; 
            border-left: 4px solid #3b82f6;
        }
        .notification-item:hover { 
            transform: translateX(5px); 
            background-color: #f0f9ff; 
        }
        
        /* Disable Spin Button */
        .spin-button:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Card Styling */
        .card {
            box-shadow: 0 6px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 14px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }
        
        /* Button Styling */
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
        }
        
        /* Task Button Styling */
        .task-btn {
            transition: all 0.3s ease;
            border-radius: 10px;
            padding: 12px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.05);
            min-height: 90px;
        }
        .task-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* Progress Bar */
        .progress-bar {
            height: 8px;
            border-radius: 4px;
            background-color: #e5e7eb;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #34d399);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        /* Balance Display */
        .balance-display {
            color: white;
            border-radius: 10px;
            padding: 10px 8px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            min-width: 90px;
        }
        .points-display {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }
        .cash-display {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        /* Bottom Navigation - Mobile Optimized */
        .bottom-nav {
            box-shadow: 0 -4px 8px -1px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(12px);
            background-color: rgba(255, 255, 255, 0.98);
            border-top: 1px solid #f1f5f9;
            padding: 8px 4px;
        }
        .nav-btn {
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 8px 6px;
            font-size: 0.7rem;
        }
        .nav-btn.active {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            box-shadow: 0 3px 6px rgba(59, 130, 246, 0.3);
        }
        
        /* Animation for points conversion */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .pulse-animation {
            animation: pulse 0.5s ease-in-out;
        }
        
        /* Premium Wheel Stand */
        .wheel-stand {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 20px;
            background: linear-gradient(to bottom, 
                #8B7355 0%, 
                #654321 50%, 
                #4A3728 100%);
            border-radius: 4px;
            z-index: -1;
            box-shadow: 
                0 5px 15px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(139,115,85,0.5);
        }
        .wheel-stand::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 10px;
            background: linear-gradient(to bottom, 
                #A0826D 0%, 
                #8B7355 100%);
            border-radius: 3px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }
        .wheel-stand::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            height: 2px;
            background: rgba(139,115,85,0.5);
            border-radius: 1px;
        }
        
        /* Premium Glow effect during spin */
        .wheel-glow {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 140%;
            height: 140%;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255, 215, 0, 0.4) 0%, 
                rgba(255, 165, 0, 0.3) 30%,
                rgba(255, 215, 0, 0.2) 50%,
                transparent 70%);
            opacity: 0;
            z-index: -1;
            transition: opacity 0.5s ease;
            animation: rotateGlow 3s linear infinite;
        }
        @keyframes rotateGlow {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        .wheel.spinning ~ .wheel-glow {
            opacity: 1;
            animation: rotateGlow 1s linear infinite;
        }

        /* Mobile Optimized Typography */
        @media (max-width: 640px) {
            .text-3xl { font-size: 1.5rem; }
            .text-2xl { font-size: 1.3rem; }
            .text-xl { font-size: 1.1rem; }
            .text-lg { font-size: 1rem; }
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 20px;
            padding: 0;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            padding: 20px;
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-body {
            padding: 24px;
            max-height: calc(85vh - 80px);
            overflow-y: auto;
        }
        
        .close-modal {
            color: white;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        /* Safe area for notch phones */
        .safe-area-bottom {
            padding-bottom: env(safe-area-inset-bottom);
        }
        
        /* Winner Animation */
        @keyframes winnerPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .winner-pulse {
            animation: winnerPulse 0.5s ease-in-out 3;
        }

        /* Wheel Spinning Animation */
        @keyframes wheelSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(var(--final-rotation, 0deg)); }
        }

        .wheel.spinning {
            animation: wheelSpin 4s cubic-bezier(0.2, 0.8, 0.3, 0.95) forwards;
        }

        /* Hidden class for withdrawal fields */
        .hidden {
            display: none;
        }

        /* Custom animation for modal */
        @keyframes scale {
            0% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }
        .animate-scale {
            animation: scale 0.3s ease-out forwards;
        }
        
        /* Auth form styling */
        .auth-form {
            max-width: 400px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #374151;
        }
        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.3s;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .toggle-form {
            color: #3b82f6;
            cursor: pointer;
            text-decoration: underline;
        }
        .toggle-form:hover {
            color: #1d4ed8;
        }
        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        .success-message {
            color: #10b981;
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
        
        /* Loading spinner */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
        }
        .toast.show {
            transform: translateX(0);
        }
        .toast.success {
            background-color: #10b981;
        }
        .toast.error {
            background-color: #ef4444;
        }
        .toast.info {
            background-color: #3b82f6;
        }
        
        /* Referral Code Styling */
        .referral-code-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .referral-code {
            font-size: 24px;
            font-weight: bold;
            letter-spacing: 2px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        .referral-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        .referral-stat {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            text-align: center;
        }
        
        /* Forget Password Page Styling */
        .forget-password-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        .forget-password-section.active {
            display: block;
        }
        
        .forget-password-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            max-width: 450px;
            margin: 0 auto;
        }
        
        .forget-password-header {
            background: #4a6ee0;
            color: white;
            padding: 25px;
            text-align: center;
        }
        
        .forget-password-header h1 {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .forget-password-header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .forget-password-body {
            padding: 30px;
        }
        
        .instructions {
            background: #e6fffa;
            border: 1px solid #81e6d9;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #234e52;
        }
        
        .instructions h3 {
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .forget-password-loader {
            display: none;
            text-align: center;
            margin: 10px 0;
        }
        
        .forget-password-loader-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4a6ee0;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @media (max-width: 480px) {
            .forget-password-body {
                padding: 20px;
            }
            
            .forget-password-header {
                padding: 20px;
            }
        }
        
        /* Withdrawal Success Animation */
        .withdrawal-success-animation {
            animation: successPulse 0.6s ease-in-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(0.95); opacity: 0; }
            70% { transform: scale(1.02); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Offline Modal Styles */
        .offline-modal {
            display: none;
            position: fixed;
            z-index: 99999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            animation: fadeIn 0.3s ease;
        }

        .offline-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .offline-content {
            background: white;
            border-radius: 20px;
            width: 90%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: slideUp 0.4s ease;
        }

        .offline-icon {
            font-size: 80px;
            margin-bottom: 20px;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .offline-title {
            font-size: 24px;
            font-weight: bold;
            color: #ef4444;
            margin-bottom: 10px;
        }

        .offline-message {
            color: #6b7280;
            font-size: 16px;
            margin-bottom: 20px;
        }

        .offline-retry-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            padding: 12px 30px;
            border-radius: 10px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .offline-retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(59, 130, 246, 0.4);
        }

        /* NEW: Ad Timer Modal Styles */
        .ad-timer-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            animation: fadeIn 0.3s ease;
        }

        .ad-timer-modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .ad-timer-content {
            background: white;
            border-radius: 20px;
            width: 95%;
            max-width: 400px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
        }

        .ad-timer-header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .ad-timer-close {
            position: absolute;
            top: 15px;
            right: 20px;
            color: white;
            font-size: 24px;
            cursor: pointer;
            background: rgba(255,255,255,0.2);
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .ad-timer-close:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        .ad-timer-body {
            padding: 30px 20px;
            text-align: center;
        }

        .timer-display {
            font-size: 72px;
            font-weight: bold;
            color: #2c3e50;
            margin: 20px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .timer-progress {
            width: 100%;
            height: 12px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 25px 0;
        }

        .timer-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00b894, #00cec9);
            border-radius: 10px;
            transition: width 1s linear;
            width: 0%;
        }

        .ad-container {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            border: 2px dashed #bdc3c7;
            min-height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        .ad-placeholder {
            font-size: 48px;
            color: #7f8c8d;
            margin-bottom: 10px;
        }

        .ad-text {
            color: #34495e;
            font-weight: 600;
            font-size: 16px;
        }

        .points-reward {
            background: linear-gradient(135deg, #fdcb6e, #e17055);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            font-weight: bold;
            font-size: 18px;
        }

        .ad-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            font-size: 14px;
            color: #856404;
        }

        .ad-complete-message {
            display: none;
            background: linear-gradient(135deg, #00b894, #55efc4);
            color: white;
            padding: 16px 20px;
            border-radius: 12px;
            margin: 15px 0;
            text-align: center;
            position: relative;
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
        }

        .ad-complete-message.active {
            display: block;
            animation: bounceIn 0.5s ease;
        }

        /* Modal Top-Right Close Button */
        .modal-close-btn {
            position: fixed;
            top: 15px;
            right: 15px;
            background: white;
            border: 3px solid #00b894;
            color: #00b894;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 28px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            line-height: 1;
            box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3);
            z-index: 10000;
        }

        .modal-close-btn:hover {
            background: #00b894;
            color: white;
            transform: scale(1.2) rotate(90deg);
            box-shadow: 0 6px 20px rgba(0, 184, 148, 0.5);
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* NEW: Iframe Ad Overlay with Timer */
        .ad-iframe-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10000;
            background: #000;
        }

        .ad-iframe-overlay.active {
            display: block;
        }

        .ad-iframe-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        .ad-iframe-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .timer-overlay {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 10001;
            pointer-events: none;
        }

        .timer-overlay.completed {
            pointer-events: auto;
        }

        .timer-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 8px 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            text-align: center;
            animation: timerPulse 2s ease-in-out infinite;
            min-width: 70px;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5); }
            50% { transform: scale(1.03); box-shadow: 0 6px 16px rgba(102, 126, 234, 0.6); }
        }

        .timer-number {
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 2px;
            line-height: 1;
        }

        .timer-text {
            color: rgba(255, 255, 255, 0.9);
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .cut-button {
            display: none;
            background: linear-gradient(135deg, #00b894, #55efc4);
            color: white;
            border: none;
            padding: 8px 20px;
            font-size: 14px;
            font-weight: bold;
            border-radius: 30px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 184, 148, 0.5);
            transition: all 0.3s ease;
            margin-top: 6px;
            animation: buttonAppear 0.5s ease;
        }

        .cut-button.visible {
            display: inline-block;
        }

        .cut-button:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 16px rgba(0, 184, 148, 0.7);
        }

        .cut-button:active {
            transform: translateY(0) scale(0.98);
        }

        @keyframes buttonAppear {
            0% { transform: scale(0); opacity: 0; }
            70% { transform: scale(1.1); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        /* Ad Button Styling - Enhanced UX */
        .ad-task-btn {
            background: linear-gradient(135deg, #ff6b9d, #c44569);
            color: white;
            border: none;
            border-radius: 16px;
            padding: 18px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 20px rgba(196, 69, 105, 0.35);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 105px;
            position: relative;
            overflow: hidden;
        }

        .ad-task-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .ad-task-btn:hover::before {
            left: 100%;
        }

        .ad-task-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 12px 30px rgba(196, 69, 105, 0.45);
        }

        .ad-task-btn:active {
            transform: translateY(-2px) scale(0.98);
            box-shadow: 0 6px 15px rgba(196, 69, 105, 0.3);
        }

        .ad-task-btn i {
            font-size: 36px;
            margin-bottom: 10px;
            animation: playIconPulse 2s ease-in-out infinite;
        }

        @keyframes playIconPulse {
            0%, 100% { 
                transform: scale(1); 
                filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5));
            }
            50% { 
                transform: scale(1.1); 
                filter: drop-shadow(0 0 10px rgba(255, 255, 255, 0.8));
            }
        }

        .ad-task-btn .font-semibold {
            font-size: 17px;
            letter-spacing: 0.5px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .ad-task-btn .text-sm {
            background: rgba(255, 255, 255, 0.25);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 14px;
            margin-top: 8px;
            backdrop-filter: blur(10px);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        
        /* Simple Welcome Bonus Popup */
        .welcome-bonus-popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .welcome-bonus-popup.active {
            display: flex;
        }

        .welcome-bonus-content {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            max-width: 90%;
            width: 350px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .bonus-icon {
            font-size: 60px;
            color: #f59e0b;
            margin-bottom: 15px;
        }

        .bonus-title {
            font-size: 24px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 10px;
        }

        .bonus-amount {
            font-size: 32px;
            font-weight: bold;
            color: #10b981;
            margin: 15px 0;
        }

        .bonus-message {
            font-size: 16px;
            color: #6b7280;
            margin-bottom: 20px;
        }

        .bonus-button {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 12px 30px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .bonus-button:hover {
            background: #2563eb;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 font-sans safe-area-bottom">
    
    <!-- Simple Welcome Bonus Popup -->
    <div id="welcomeBonusPopup" class="welcome-bonus-popup">
        <div class="welcome-bonus-content">
            <div class="bonus-icon">
                <i class="fas fa-gift"></i>
            </div>
            <h1 class="bonus-title">Welcome Bonus!</h1>
            <div class="bonus-amount">‚Çπ5 + 100 Points</div>
            <p class="bonus-message">Your account has been credited with welcome bonus</p>
            <button id="closeBonusPopup" class="bonus-button">OK</button>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <!-- NEW: Ad Timer Modal -->
    <div id="adTimerModal" class="ad-timer-modal">
        <div class="ad-timer-content">
            <div class="ad-timer-header">
                <h2 class="text-xl font-bold" id="adModalTitle">üé¨ Watch Ad to Earn</h2>
                <div class="ad-timer-close" onclick="closeAdTimer()" id="adModalCloseX">√ó</div>
            </div>
            <div class="ad-timer-body">
                <div class="timer-display" id="adTimerDisplay">20</div>
                
                <div class="timer-progress">
                    <div class="timer-progress-fill" id="adTimerProgress"></div>
                </div>

                <div class="ad-container">
                    <div class="ad-placeholder">üì±</div>
                    <div class="ad-text" id="adContentText">Advertisement Loading...</div>
                    <div id="adContainer"></div>
                </div>

                <div class="points-reward">
                    üéÅ Earn <span id="rewardPoints">100</span> Points!
                </div>

                <div class="ad-warning">
                    ‚ö†Ô∏è Wait for the timer to complete to claim your reward!
                </div>

                <div class="ad-complete-message" id="adCompleteMessage">
                    <div style="font-size: 36px; margin-bottom: 8px;">üéâ</div>
                    <h3 style="font-size: 18px; margin-bottom: 6px; font-weight: 700;">Congratulations!</h3>
                    <p style="font-size: 15px; margin-bottom: 12px;">You earned <strong id="earnedPointsText">100</strong> Points!</p>
                    <button onclick="closeAdTimer()" class="btn-primary" style="padding: 10px 24px; font-size: 14px; border-radius: 8px;">
                        Claim Reward
                    </button>
                </div>
            </div>
            <!-- Close Button - Screen Top Right (Cut Button) -->
            <button class="modal-close-btn" id="adCompleteCloseBtn" onclick="closeAdTimer()" title="Close" style="display: none;">√ó</button>
        </div>
    </div>

    <!-- NEW: Iframe Ad Overlay for Special Offers -->
    <div id="adIframeOverlay" class="ad-iframe-overlay">
        <div class="ad-iframe-container">
            <iframe id="adIframe" src="about:blank"></iframe>
        </div>
        <div class="timer-overlay" id="timerOverlay">
            <div class="timer-box">
                <div class="timer-number" id="overlayTimerDisplay">20</div>
                <div class="timer-text">Please wait...</div>
            </div>
            <button class="cut-button" id="cutButton" onclick="claimSpecialOfferReward()">
                Cut ‚úÇÔ∏è
            </button>
        </div>
    </div>

    <!-- Auth Section -->
    <div id="auth" class="auth-section active">
        <div class="container max-w-4xl mx-auto px-3 py-8">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-blue-600 flex items-center justify-center">
                    <i class="fas fa-coins mr-3 text-yellow-500"></i> Tez Earn
                </h1>
                <p class="text-gray-600 mt-2">Sign in to start earning rewards</p>
            </div>
            
            <div class="card bg-white p-6 auth-form">
                <!-- Login Form -->
                <div id="login-form">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Sign In</h2>
                    
                    <div class="form-group">
                        <label class="form-label" for="login-email">Email</label>
                        <input type="email" id="login-email" class="form-input" placeholder="Enter your email">
                        <div id="login-email-error" class="error-message hidden"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="login-password">Password</label>
                        <input type="password" id="login-password" class="form-input" placeholder="Enter your password">
                        <div id="login-password-error" class="error-message hidden"></div>
                    </div>
                    
                    <button id="login-btn" class="btn-primary py-3 rounded-lg text-lg font-bold w-full mb-4">
                        <span id="login-text">Sign In</span>
                        <span id="login-loading" class="hidden"></span>
                    </button>
                    
                    <div id="login-message" class="success-message text-center hidden"></div>
                    
                    <div class="text-center mt-4">
                        <p class="text-gray-600">Don't have an account? 
                            <span class="toggle-form" onclick="showSignupForm()">Sign Up</span>
                        </p>
                        <!-- Forget Password Link -->
                        <p class="text-gray-600 mt-2">
                            <span class="toggle-form" onclick="showForgetPasswordPage()">Forgot Password?</span>
                        </p>
                    </div>
                </div>
                
                <!-- Signup Form -->
                <div id="signup-form" class="hidden">
                    <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">Create Account</h2>
                    
                    <div class="form-group">
                        <label class="form-label" for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" class="form-input" placeholder="Enter your full name">
                        <div id="signup-name-error" class="error-message hidden"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="signup-email">Email</label>
                        <input type="email" id="signup-email" class="form-input" placeholder="Enter your email">
                        <div id="signup-email-error" class="error-message hidden"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-input" placeholder="Create a password">
                        <div id="signup-password-error" class="error-message hidden"></div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label" for="signup-confirm-password">Confirm Password</label>
                        <input type="password" id="signup-confirm-password" class="form-input" placeholder="Confirm your password">
                        <div id="signup-confirm-password-error" class="error-message hidden"></div>
                    </div>
                    
                    <!-- Referral Code Input (Only show if coming from referral) -->
                    <div id="referral-input-container" class="form-group hidden">
                        <label class="form-label" for="referral-code">Referral Code (Optional)</label>
                        <input type="text" id="referral-code" class="form-input" placeholder="Enter referral code if any">
                        <div id="referral-code-error" class="error-message hidden"></div>
                    </div>
                    
                    <button id="signup-btn" class="btn-primary py-3 rounded-lg text-lg font-bold w-full mb-4">
                        <span id="signup-text">Create Account</span>
                        <span id="signup-loading" class="hidden"></span>
                    </button>
                    
                    <div id="signup-message" class="success-message text-center hidden"></div>
                    
                    <div class="text-center mt-4">
                        <p class="text-gray-600">Already have an account? 
                            <span class="toggle-form" onclick="showLoginForm()">Sign In</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Forget Password Page -->
    <div id="forget-password-page" class="forget-password-section">
        <div class="container max-w-4xl mx-auto px-3 py-8">
            <div class="forget-password-card">
                <div class="forget-password-header">
                    <h1>Reset Your Password</h1>
                    <p>Enter your email to receive a reset link</p>
                </div>
                <div class="forget-password-body">
                    <div class="instructions">
                        <h3>How it works:</h3>
                        <p>Enter your email address and we'll send you a link to reset your password. This link will expire in 1 hour for security.</p>
                    </div>
                    
                    <div id="successMessage" class="success-message hidden">
                        Reset link sent successfully! Please check your email.
                    </div>
                    
                    <div id="errorMessage" class="error-message hidden">
                        Please enter a valid email address.
                    </div>
                    
                    <form id="forgotPasswordForm">
                        <div class="form-group">
                            <label class="form-label" for="reset-email">Email Address</label>
                            <input type="email" id="reset-email" class="form-input" placeholder="Enter your email address" required>
                        </div>
                        
                        <div class="forget-password-loader" id="resetLoader">
                            <div class="forget-password-loader-spinner"></div>
                            <p>Sending reset link...</p>
                        </div>
                        
                        <button type="submit" class="btn-primary py-3 rounded-lg text-lg font-bold w-full mb-4">
                            Send Reset Link
                        </button>
                    </form>
                    
                    <div class="text-center mt-4">
                        <p class="text-gray-600">Remember your password? 
                            <span class="toggle-form" onclick="showLoginForm()">Back to Sign In</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (hidden initially) -->
    <div id="app" class="auth-section">
        <div class="container max-w-4xl mx-auto px-3 py-2">
            <!-- Header with Balance - Mobile Optimized -->
            <div class="flex justify-between items-center mb-6">
                <!-- Points Display -->
                <div class="balance-display points-display">
                    <p class="text-xs font-semibold">Points</p>
                    <p class="text-lg font-bold"><span id="points-header">0</span> pts</p>
                </div>
                
                <!-- Center Logo -->
                <h1 class="text-xl font-bold text-blue-600 flex items-center mx-2">
                    <i class="fas fa-coins mr-2 text-yellow-500"></i> <span id="app-name-header">Tez Earn</span>
                </h1>
                
                <!-- Cash Display -->
                <div class="balance-display cash-display">
                    <p class="text-xs font-semibold">Balance</p>
                    <p class="text-lg font-bold">‚Çπ<span id="balance-header">0.00</span></p>
                </div>
            </div>

            <!-- Home Section -->
            <div id="home" class="app-section active">
                <!-- Task List -->
                <div class="card bg-white p-4 mb-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <i class="fas fa-tasks mr-2 text-blue-500"></i> Earn Points
                    </h3>
                    <div class="grid grid-cols-2 gap-3 mb-6">
                        <!-- UPDATED: Watch Ads Button with Smartlink -->
                        <button onclick="startSmartlinkAd()" class="ad-task-btn">
                            <i class="fas fa-play-circle"></i>
                            <span class="font-semibold">Watch Ads</span>
                            <span class="text-sm opacity-90 mt-1">Earn 100 Points</span>
                            <span class="text-xs opacity-75 mt-1" id="watchAdsCount">0/20 today</span>
                        </button>
                        
                        <!-- Special Offers Button -->
                        <button onclick="startSpecialOffer()" class="task-btn bg-gradient-to-br from-green-400 to-green-600 text-white flex flex-col items-center justify-center">
                            <i class="fas fa-gift text-2xl mb-2"></i>
                            <span class="font-semibold text-sm">Special Offers</span>
                            <span class="text-xs opacity-90 mt-1">200 Points</span>
                            <span class="text-xs opacity-75 mt-1" id="specialOffersCount">0/30 today</span>
                        </button>
                        
                        <button class="task-btn bg-gradient-to-br from-indigo-400 to-indigo-600 text-white">
                            <i class="fas fa-share-alt text-2xl mb-2"></i>
                            <span class="font-semibold text-sm">Refer Friends</span>
                        </button>
                    </div>
                    
                    
                    <!-- Professional Premium Spin Wheel -->
                    <div class="text-center mb-6 py-6 bg-gradient-to-br from-amber-50 via-white to-yellow-50 rounded-xl border-2 border-yellow-200 shadow-lg">
                        <h3 class="text-xl font-bold text-gray-800 mb-2 flex items-center justify-center">
                            <i class="fas fa-trophy text-yellow-500 mr-2"></i>
                            Lucky Spin Wheel
                            <i class="fas fa-star text-yellow-500 ml-2"></i>
                        </h3>
                        <p class="text-gray-600 mb-3 text-sm" id="spin-cooldown-text">Spins today: 0/5</p>
                        
                        <div class="wheel-container">
                            <!-- Premium 3D Arrow Pointer -->
                            <div class="wheel-pointer">
                                <div class="arrow-body"></div>
                            </div>
                            
                            <!-- SVG-Based Wheel for Perfect Segments -->
                            <div id="wheel" class="wheel">
                                <svg class="wheel-svg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                                    <defs>
                                        <!-- Gradients for each segment -->
                                         <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                        </linearGradient>
                                        <linearGradient id="grad2" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#f093fb;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#f5576c;stop-opacity:1" />
                                        </linearGradient>
                                        <linearGradient id="grad3" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#4facfe;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#00f2fe;stop-opacity:1" />
                                        </linearGradient>
                                        <linearGradient id="grad4" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#43e97b;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#38f9d7;stop-opacity:1" />
                                        </linearGradient>
                                        <linearGradient id="grad5" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#fa709a;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#fee140;stop-opacity:1" />
                                        </linearGradient>
                                        <linearGradient id="grad6" x1="0%" y1="0%" x2="100%" y2="100%">
                                            <stop offset="0%" style="stop-color:#30cfd0;stop-opacity:1" />
                                            <stop offset="100%" style="stop-color:#330867;stop-opacity:1" />
                                        </linearGradient>
                                        
                                        <!-- 3D Effect Filter -->
                                        <filter id="shadow">
                                            <feGaussianBlur in="SourceAlpha" stdDeviation="3"/>
                                            <feOffset dx="2" dy="2" result="offsetblur"/>
                                            <feComponentTransfer>
                                                <feFuncA type="linear" slope="0.5"/>
                                            </feComponentTransfer>
                                            <feMerge>
                                                <feMergeNode/>
                                                <feMergeNode in="SourceGraphic"/>
                                            </feMerge>
                                        </filter>
                                    </defs>
                                    
                                    <!-- 6 Equal Segments (60 degrees each) -->
                                    <g id="wheel-segments">
                                        <!-- Segment 1 -->
                                        <path d="M100,100 L100,10 A90,90 0 0,1 177.94,50 Z" fill="url(#grad1)" class="wheel-segment" filter="url(#shadow)"/>
                                        <text x="130" y="50" class="segment-text" text-anchor="middle" dominant-baseline="middle">10</text>
                                        
                                        <!-- Segment 2 -->
                                        <path d="M100,100 L177.94,50 A90,90 0 0,1 177.94,150 Z" fill="url(#grad2)" class="wheel-segment" filter="url(#shadow)"/>
                                        <text x="155" y="100" class="segment-text" text-anchor="middle" dominant-baseline="middle">20</text>
                                        
                                        <!-- Segment 3 -->
                                        <path d="M100,100 L177.94,150 A90,90 0 0,1 100,190 Z" fill="url(#grad3)" class="wheel-segment" filter="url(#shadow)"/>
                                        <text x="130" y="150" class="segment-text" text-anchor="middle" dominant-baseline="middle">30</text>
                                        
                                        <!-- Segment 4 -->
                                        <path d="M100,100 L100,190 A90,90 0 0,1 22.06,150 Z" fill="url(#grad4)" class="wheel-segment" filter="url(#shadow)"/>
                                        <text x="70" y="150" class="segment-text" text-anchor="middle" dominant-baseline="middle">40</text>
                                        
                                        <!-- Segment 5 -->
                                        <path d="M100,100 L22.06,150 A90,90 0 0,1 22.06,50 Z" fill="url(#grad5)" class="wheel-segment" filter="url(#shadow)"/>
                                        <text x="45" y="100" class="segment-text" text-anchor="middle" dominant-baseline="middle">50</text>
                                        
                                        <!-- Segment 6 -->
                                        <path d="M100,100 L22.06,50 A90,90 0 0,1 100,10 Z" fill="url(#grad6)" class="wheel-segment" filter="url(#shadow)"/>
                                        <text x="70" y="50" class="segment-text" text-anchor="middle" dominant-baseline="middle">60</text>
                                    </g>
                                    
                                    <!-- Segment Divider Lines -->
                                    <line x1="100" y1="100" x2="100" y2="10" class="segment-divider"/>
                                    <line x1="100" y1="100" x2="177.94" y2="50" class="segment-divider"/>
                                    <line x1="100" y1="100" x2="177.94" y2="150" class="segment-divider"/>
                                    <line x1="100" y1="100" x2="100" y2="190" class="segment-divider"/>
                                    <line x1="100" y1="100" x2="22.06" y2="150" class="segment-divider"/>
                                    <line x1="100" y1="100" x2="22.06" y2="50" class="segment-divider"/>
                                    
                                    <!-- Center Circle - Blank, stationary center added via CSS -->
                                    <circle cx="100" cy="100" r="20" fill="rgba(255,255,255,0.1)" stroke="#fff" stroke-width="3"/>
                                </svg>
                            </div>
                            <!-- Stationary Center Circle - Does not rotate -->
                            <div class="wheel-center"></div>
                            <div class="wheel-glow"></div>
                            <div class="wheel-stand"></div>
                        </div>
                        
                        <button onclick="spin()" class="spin-button btn-primary py-3 px-8 rounded-lg text-lg font-bold mt-6 w-full max-w-xs">
                            <i class="fas fa-sync-alt mr-2"></i> SPIN NOW
                        </button>
                    </div>
                    
                    <!-- Referral System - UPDATED WITH UNIQUE CODES -->
                    <div class="referral mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center justify-center">
                            <i class="fas fa-user-friends mr-2 text-blue-500"></i> Refer & Earn
                        </h3>
                        <p class="text-gray-600 mb-4 text-sm text-center" id="referral-bonus-text">
                            Invite friends and earn 100 bonus points!
                        </p>
                        
                        <!-- Referral Code Display -->
                        <div class="referral-code-display">
                            <p class="text-sm opacity-90">Your Unique Referral Code</p>
                            <div class="referral-code" id="user-referral-code">TEZ123</div>
                            <button onclick="copyReferralCode()" class="bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold text-sm flex items-center justify-center mx-auto">
                                <i class="fas fa-copy mr-2"></i> Copy Code
                            </button>
                        </div>
                        
                        <div class="flex flex-col gap-2">
                            <input type="text" id="referral-link" value="Loading..." readonly class="border border-blue-200 rounded-lg p-3 bg-white text-sm font-mono">
                            <button onclick="copyReferralLink()" class="btn-primary py-3 rounded-lg flex items-center justify-center text-sm font-semibold">
                                <i class="fas fa-copy mr-2"></i> Copy Link
                            </button>
                            
                            <!-- WhatsApp Share Button -->
                            <button onclick="shareOnWhatsApp()" class="bg-gradient-to-br from-green-500 to-green-600 text-white py-3 rounded-lg flex items-center justify-center text-sm font-semibold mt-2">
                                <i class="fab fa-whatsapp mr-2 text-lg"></i> Share on WhatsApp
                            </button>
                        </div>
                        
                        <!-- Referral Stats -->
                        <div class="referral-stats">
                            <div class="referral-stat">
                                <p class="text-xs opacity-80">Total Referrals</p>
                                <p class="text-lg font-bold" id="total-referrals">0</p>
                            </div>
                            <div class="referral-stat">
                                <p class="text-xs opacity-80">Bonus Earned</p>
                                <p class="text-lg font-bold" id="referral-bonus-earned">0 pts</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Notification System -->
                <div class="card bg-white p-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <i class="fas fa-bell mr-2 text-yellow-500"></i> Notifications
                    </h3>
                    <ul id="notification-list" class="space-y-3">
                        <li class="notification-item p-3 rounded-lg bg-white border border-gray-200">
                            <div class="flex justify-between items-start">
                                <span class="font-semibold text-gray-800 text-sm flex-1">New Offer: Complete Survey for 50 points!</span>
                                <span class="text-gray-500 text-xs bg-gray-100 px-2 py-1 rounded-full ml-2 flex-shrink-0">2025-09-30</span>
                            </div>
                        </li>
                        <li class="notification-item p-3 rounded-lg bg-white border border-gray-200">
                            <div class="flex justify-between items-start">
                                <span class="font-semibold text-gray-800 text-sm flex-1">Referral Bonus: 100 points earned!</span>
                                <span class="text-gray-500 text-xs bg-gray-100 px-2 py-1 rounded-full ml-2 flex-shrink-0">2025-09-29</span>
                            </div>
                        </li>
                    </ul>
                </div>
                
            </div>

            <!-- Convert Section - FIXED -->
            <div id="convert" class="app-section">
                <div class="card bg-white p-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <i class="fas fa-exchange-alt mr-2 text-green-500"></i> Convert Points
                    </h3>
                    <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-xl mb-6 border border-green-200">
                        <div class="flex flex-col space-y-4 mb-4">
                            <div class="text-center">
                                <p class="text-gray-600 text-sm">Current Points</p>
                                <p class="text-2xl font-bold text-gray-800 mt-1"><span id="points-convert">0</span> points</p>
                            </div>
                            <div class="text-center">
                                <p class="text-gray-600 text-sm">Conversion Rate</p>
                                <p class="text-lg font-semibold text-gray-800 mt-1" id="conversion-rate-text">1 point = ‚Çπ0.1</p>
                            </div>
                        </div>
                        <div class="text-center p-4 bg-white rounded-lg border border-green-300 shadow">
                            <p class="text-gray-600 text-sm">Equivalent Amount</p>
                            <p class="text-2xl font-bold text-green-600 mt-2">‚Çπ<span id="balance-convert">0.00</span></p>
                        </div>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-xl border border-gray-200">
                        <h4 class="font-bold text-gray-800 text-lg mb-3 text-center">Convert Points</h4>
                        <div class="flex flex-col gap-3">
                            <input type="number" id="convert-amount" placeholder="Enter points to convert (Min: 10)" class="border border-blue-200 rounded-lg p-3 text-sm">
                            <button onclick="convertPoints()" class="btn-primary py-3 rounded-lg text-sm font-semibold">
                                Convert Now
                            </button>
                        </div>
                        <!-- ‚úÖ FIXED: Dynamic minimum points text -->
                        <p class="text-xs text-gray-600 mt-3 text-center" id="min-convert-text">Minimum conversion: 10 points</p>
                    </div>
                </div>
            </div>

            <!-- Wallet Section -->
            <div id="wallet" class="app-section">
                <div class="card bg-white p-4">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center justify-center">
                        <i class="fas fa-wallet mr-2 text-purple-500"></i> Wallet
                    </h3>
                    
                    <!-- Balance Summary -->
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="points-display p-4 rounded-lg text-center">
                            <i class="fas fa-coins text-2xl mb-2"></i>
                            <p class="font-bold text-sm">Points</p>
                            <p class="text-xl font-bold mt-1"><span id="points-wallet">0</span> pts</p>
                        </div>
                        <div class="cash-display p-4 rounded-lg text-center">
                            <i class="fas fa-rupee-sign text-2xl mb-2"></i>
                            <p class="font-bold text-sm">Balance</p>
                            <p class="text-xl font-bold mt-1">‚Çπ<span id="balance-wallet">0.00</span></p>
                        </div>
                    </div>
                    
                    <!-- Withdrawal Form -->
                    <div class="withdrawal-form bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-xl border border-purple-200 mb-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center justify-center">
                            <i class="fas fa-money-bill-wave mr-2"></i> Withdraw
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-gray-700 text-sm mb-1 font-semibold">Method</label>
                                <select name="method" id="withdrawal-method" class="border border-purple-200 rounded-lg p-3 w-full text-sm" onchange="showMethodFields()">
                                    <option value="upi">UPI</option>
                                    <option value="paytm">Paytm</option>
                                    <option value="bank">Bank Transfer</option>
                                </select>
                            </div>
                            
                            <!-- UPI ID Field (shown when UPI is selected) -->
                            <div id="upi-fields" class="method-fields">
                                <label class="block text-gray-700 text-sm mb-1 font-semibold">UPI ID</label>
                                <input type="text" id="upi-id" placeholder="Enter your UPI ID (e.g. name@paytm)" class="border border-purple-200 rounded-lg p-3 w-full text-sm">
                            </div>
                            
                            <!-- Paytm Phone Number Field (shown when Paytm is selected) -->
                            <div id="paytm-fields" class="method-fields hidden">
                                <label class="block text-gray-700 text-sm mb-1 font-semibold">Paytm Number</label>
                                <input type="text" id="paytm-number" placeholder="Enter your Paytm number" class="border border-purple-200 rounded-lg p-3 w-full text-sm">
                            </div>
                            
                            <!-- Bank Transfer Fields (shown when Bank Transfer is selected) -->
                            <div id="bank-fields" class="method-fields hidden">
                                <label class="block text-gray-700 text-sm mb-1 font-semibold">Account Holder Name</label>
                                <input type="text" id="account-holder" placeholder="Enter account holder name" class="border border-purple-200 rounded-lg p-3 w-full text-sm mb-3">
                                
                                <label class="block text-gray-700 text-sm mb-1 font-semibold">Account Number</label>
                                <input type="text" id="account-number" placeholder="Enter your account number" class="border border-purple-200 rounded-lg p-3 w-full text-sm mb-3">
                                
                                <label class="block text-gray-700 text-sm mb-1 font-semibold">IFSC Code</label>
                                <input type="text" id="ifsc-code" placeholder="Enter IFSC code" class="border border-purple-200 rounded-lg p-3 w-full text-sm">
                            </div>
                            
                            <div>
                                <label class="block text-gray-700 text-sm mb-1 font-semibold" id="withdrawal-amount-label">Amount (Min: ‚Çπ100)</label>
                                <input type="number" id="withdrawal-amount" placeholder="Enter amount (Min: ‚Çπ100)" min="100" class="border border-purple-200 rounded-lg p-3 w-full text-sm">
                            </div>
                            <button onclick="submitWithdrawal()" class="btn-primary py-3 rounded-lg text-sm font-bold w-full">
                                <i class="fas fa-paper-plane mr-2"></i> Submit Request
                            </button>
                        </div>
                    </div>
                    
                    <!-- Transaction History -->
                    <div class="transaction-history">
                        <h4 class="text-lg font-bold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-history mr-2"></i> Transactions
                        </h4>
                        <ul id="transaction-list" class="space-y-3">
                            <!-- Transactions will be loaded dynamically -->
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Profile Section -->
            <div id="profile" class="app-section">
                <div class="card bg-white p-4">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-xl font-bold text-gray-800 flex items-center">
                            <i class="fas fa-user-circle mr-2 text-blue-500"></i> Profile
                        </h3>
                        <button onclick="logout()" class="bg-red-500 text-white w-8 h-8 rounded-full hover:bg-red-600 transition-all shadow-md flex items-center justify-center" title="Logout">
                            <i class="fas fa-sign-out-alt text-sm"></i>
                        </button>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-cyan-50 p-4 rounded-xl mb-6 border border-blue-200">
                        <!-- User Info -->
                        <div class="flex items-center mb-4">
                            <div class="w-16 h-16 bg-gradient-to-br from-blue-400 to-blue-600 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                <span id="user-initials">U</span>
                            </div>
                            <div class="ml-4">
                                <h4 class="font-bold text-gray-800 text-lg" id="user-name">User Name</h4>
                                <p class="text-gray-600 text-sm" id="user-email">user@example.com</p>
                                <!-- Referral Code in Profile -->
                                <p class="text-blue-500 text-sm font-mono mt-1">
                                    <i class="fas fa-user-friends mr-1"></i> 
                                    Referral Code: <span id="profile-referral-code">Loading...</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Points and Balance Summary -->
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="points-display p-3 rounded-lg text-center">
                                <p class="text-xs font-semibold">Points</p>
                                <p class="text-lg font-bold mt-1"><span id="points-profile">0</span> pts</p>
                            </div>
                            <div class="cash-display p-3 rounded-lg text-center">
                                <p class="text-xs font-semibold">Balance</p>
                                <p class="text-lg font-bold mt-1">‚Çπ<span id="balance-profile">0.00</span></p>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4 mb-6">
                        <div class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200">
                            <i class="fas fa-user-friends text-xl text-blue-500 mb-2"></i>
                            <p class="font-bold text-sm">Referrals</p>
                            <p class="text-gray-600 text-sm mt-1"><span id="profile-referrals">0</span> Friends</p>
                        </div>
                        <a href="https://t.me/rgstudiopvtltd" target="_blank" class="bg-gray-50 p-4 rounded-lg text-center border border-gray-200 block hover:bg-cyan-50 transition-all cursor-pointer">
                            <i class="fab fa-telegram text-xl text-cyan-500 mb-2"></i>
                            <p class="font-bold text-sm">Telegram</p>
                            <p class="text-gray-600 text-sm mt-1">Join Us</p>
                        </a>
                    </div>
                    
                    <!-- Profile Options -->
                    <div class="space-y-3 pt-4 border-t border-gray-300">
                        <div class="grid grid-cols-3 gap-3">
                            <a href="mailto:rgstudiopvtltd@gmail.com" class="text-blue-500 hover:bg-blue-50 p-3 rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all border border-blue-200">
                                <i class="fas fa-headset text-xl mb-1"></i> Support
                            </a>
                            <button onclick="showAbout()" class="text-green-500 hover:bg-green-50 p-3 rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all border border-green-200">
                                <i class="fas fa-info-circle text-xl mb-1"></i> About
                            </button>
                            <button onclick="showPrivacyPolicy()" class="text-purple-500 hover:bg-purple-50 p-3 rounded-lg flex flex-col items-center justify-center text-xs font-semibold transition-all border border-purple-200">
                                <i class="fas fa-shield-alt text-xl mb-1"></i> Privacy
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Modal -->
        <div id="aboutModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="text-xl font-bold"><i class="fas fa-info-circle mr-2"></i> About Tez Earn Money</h2>
                    <button class="close-modal" onclick="closeAbout()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="space-y-4 text-gray-700">
                        <h3 class="text-lg font-bold text-blue-600">Welcome to Tez Earn Money!</h3>
                        
                        <p class="text-sm leading-relaxed">
                            Tez Earn Money is a revolutionary platform that allows you to earn real money by completing simple tasks, 
                            spinning the lucky wheel, watching advertisements, and referring friends. Our mission is to make earning 
                            money accessible to everyone, anytime, anywhere.
                        </p>
                        
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-sm text-blue-800 mb-2">Key Features:</h4>
                            <ul class="text-sm space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                    <span><strong>Lucky Wheel:</strong> Spin daily and win exciting rewards</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                    <span><strong>Easy Tasks:</strong> Complete simple tasks and earn points</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                    <span><strong>Referral Program:</strong> Invite friends and earn bonuses</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mt-1 mr-2"></i>
                                    <span><strong>Quick Withdrawal:</strong> Convert points to cash and withdraw easily</span>
                                </li>
                            </ul>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                            <h4 class="font-bold text-sm text-green-800 mb-2">Our Vision:</h4>
                            <p class="text-sm">
                                We believe in creating opportunities for everyone to earn money through a simple, 
                                transparent, and user-friendly platform. Your success is our success!
                            </p>
                        </div>
                        
                        <div class="text-center pt-4">
                            <p class="text-sm text-gray-600">Version 1.0.0</p>
                            <p class="text-sm text-gray-600 mt-1">¬© 2025 Tez Earn Money. All rights reserved.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Offline Modal -->
        <div id="offlineModal" class="offline-modal">
            <div class="offline-content">
                <div class="offline-icon">üì°</div>
                <h2 class="offline-title">Oops! No Internet</h2>
                <p class="offline-message">WiFi disconnected. Please check your internet connection and try again.</p>
                <button onclick="retryConnection()" class="offline-retry-btn">
                    <i class="fas fa-sync-alt mr-2"></i> Retry Connection
                </button>
            </div>
        </div>

        <!-- Privacy Policy Modal -->
        <div id="privacyModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="text-xl font-bold"><i class="fas fa-shield-alt mr-2"></i> Privacy Policy</h2>
                    <button class="close-modal" onclick="closePrivacyPolicy()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="space-y-4 text-gray-700 text-sm">
                        <p class="text-xs text-gray-500">Last Updated: January 2025</p>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">1. Introduction</h3>
                            <p class="leading-relaxed">
                                Welcome to Tez Earn Money ("we," "our," or "us"). This Privacy Policy explains how we collect, 
                                use, disclose, and safeguard your information when you use our mobile application and services. 
                                Please read this privacy policy carefully. By using our platform, you agree to the collection 
                                and use of information in accordance with this policy.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">2. Information We Collect</h3>
                            <p class="leading-relaxed mb-2">
                                <strong>Personal Information:</strong> We collect information that you provide directly to us, including:
                            </p>
                            <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                <li>Full name and email address during registration</li>
                                <li>Profile information and account preferences</li>
                                <li>Payment and withdrawal details (UPI ID, bank account information)</li>
                                <li>Transaction history and earnings data</li>
                                <li>Communication data when you contact our support team</li>
                            </ul>
                            <p class="leading-relaxed mt-2 mb-2">
                                <strong>Usage Information:</strong> We automatically collect certain information about your device and how you interact with our services:
                            </p>
                            <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                <li>Device information (model, operating system, unique device identifiers)</li>
                                <li>IP address and location data</li>
                                <li>App usage statistics and interaction patterns</li>
                                <li>Tasks completed, advertisements viewed, and spin wheel activities</li>
                                <li>Referral activities and invitation tracking</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">3. How We Use Your Information</h3>
                            <p class="leading-relaxed">
                                We use the collected information for various purposes:
                            </p>
                            <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                <li>To create and manage your account</li>
                                <li>To process points, rewards, and withdrawal requests</li>
                                <li>To provide customer support and respond to your inquiries</li>
                                <li>To send you important updates, notifications, and promotional offers</li>
                                <li>To detect and prevent fraud, abuse, and security incidents</li>
                                <li>To analyze usage patterns and improve our services</li>
                                <li>To comply with legal obligations and enforce our terms of service</li>
                                <li>To personalize your experience and provide relevant advertisements</li>
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">4. Data Security</h3>
                            <p class="leading-relaxed">
                                We take the security of your personal information seriously and implement appropriate technical 
                                and organizational measures to protect it. We use Firebase Authentication and Cloud Firestore 
                                with industry-standard encryption (SSL/TLS) to secure data transmission and storage. Our security 
                                measures include encrypted databases, secure authentication protocols, regular security audits, 
                                and access controls. However, please note that no method of transmission over the Internet or 
                                electronic storage is 100% secure, and we cannot guarantee absolute security.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">5. Information Sharing and Disclosure</h3>
                            <p class="leading-relaxed mb-2">
                                We do not sell, rent, or trade your personal information to third parties. We may share your 
                                information only in the following circumstances:
                            </p>
                            <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                <li><strong>Service Providers:</strong> With trusted third-party vendors who help us operate our platform 
                                (payment processors, cloud hosting services, analytics providers)</li>
                                <li><strong>Legal Requirements:</strong> When required by law, court order, or government request</li>
                                <li><strong>Business Transfers:</strong> In connection with a merger, acquisition, or sale of assets</li>
                                <li><strong>Fraud Prevention:</strong> To protect against fraud, abuse, and security threats</li>
                                <li><strong>With Your Consent:</strong> When you explicitly authorize us to share your information</li>
                            </ul>
                            <p class="leading-relaxed mt-2">
                                All third-party service providers are required to maintain the confidentiality and security of 
                                your information and are prohibited from using it for any purpose other than providing services to us.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">6. Your Privacy Rights</h3>
                            <p class="leading-relaxed mb-2">
                                You have the following rights regarding your personal information:
                            </p>
                            <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
                                <li><strong>Access:</strong> Request a copy of the personal information we hold about you</li>
                                <li><strong>Correction:</strong> Request correction of any inaccurate or incomplete information</li>
                                <li><strong>Deletion:</strong> Request deletion of your account and associated data</li>
                                <li><strong>Data Portability:</strong> Request transfer of your data to another service</li>
                                <li><strong>Opt-Out:</strong> Unsubscribe from marketing communications at any time</li>
                                <li><strong>Withdraw Consent:</strong> Withdraw consent for data processing where applicable</li>
                            </ul>
                            <p class="leading-relaxed mt-2">
                                To exercise any of these rights, please contact us at <strong>rgstudiopvtltd@gmail.com</strong>. 
                                We will respond to your request within 30 days.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">7. Cookies and Tracking Technologies</h3>
                            <p class="leading-relaxed">
                                We use cookies, web beacons, and similar tracking technologies to enhance your experience, 
                                analyze usage patterns, and deliver personalized content. Cookies are small text files stored 
                                on your device. You can control cookie settings through your browser preferences, but disabling 
                                cookies may limit certain features of our service. We use both session cookies (temporary) and 
                                persistent cookies (remain after you close your browser) for authentication, preferences, and analytics.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">8. Third-Party Advertisements</h3>
                            <p class="leading-relaxed">
                                Our app displays third-party advertisements to provide you with earning opportunities. These 
                                advertisers may use cookies and tracking technologies to collect information about your device 
                                and browsing activities. We are not responsible for the privacy practices of these third parties. 
                                We recommend reviewing their privacy policies separately.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">9. Children's Privacy</h3>
                            <p class="leading-relaxed">
                                Our service is not intended for individuals under the age of 18. We do not knowingly collect 
                                personal information from children under 18. If you are a parent or guardian and believe that 
                                your child has provided us with personal information, please contact us immediately, and we will 
                                take steps to remove such information from our systems.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">10. Data Retention</h3>
                            <p class="leading-relaxed">
                                We retain your personal information for as long as necessary to fulfill the purposes outlined 
                                in this Privacy Policy, unless a longer retention period is required or permitted by law. When 
                                you delete your account, we will remove your personal information from our active databases, 
                                though some information may be retained in backup copies for a limited period for legal, security, 
                                or technical reasons.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">11. International Data Transfers</h3>
                            <p class="leading-relaxed">
                                Your information may be transferred to and maintained on servers located outside your country of 
                                residence, where data protection laws may differ. By using our services, you consent to the 
                                transfer of your information to our facilities and third-party service providers with whom we share it.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">12. Changes to This Privacy Policy</h3>
                            <p class="leading-relaxed">
                                We reserve the right to update or modify this Privacy Policy at any time. We will notify you of 
                                any material changes by posting the new Privacy Policy on this page and updating the "Last Updated" 
                                date at the top. Your continued use of our services after any changes constitutes your acceptance 
                                of the revised Privacy Policy. We encourage you to review this Privacy Policy periodically.
                            </p>
                        </div>
                        
                        <div>
                            <h3 class="font-bold text-base text-blue-600 mb-2">13. User Responsibilities</h3>
                            <p class="leading-relaxed">
                                You are responsible for maintaining the confidentiality of your account credentials and for all 
                                activities that occur under your account. Please notify us immediately of any unauthorized access 
                                or use of your account. You agree to provide accurate and up-to-date information and to keep your 
                                profile information current.
                            </p>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                            <h4 class="font-bold text-sm text-blue-800 mb-2">Contact Information:</h4>
                            <p class="text-sm">
                                If you have any questions, concerns, or requests regarding this Privacy Policy or our data practices, 
                                please contact us at:
                            </p>
                            <p class="text-sm mt-2">
                                <strong>Email:</strong> <span class="text-blue-600">rgstudiopvtltd@gmail.com</span><br>
                                <strong>Response Time:</strong> We aim to respond to all inquiries within 48 hours
                            </p>
                        </div>
                        
                        <div class="bg-green-50 p-3 rounded-lg border border-green-200 mt-3">
                            <p class="text-xs text-green-800">
                                <i class="fas fa-shield-alt mr-1"></i>
                                <strong>Your privacy matters to us.</strong> We are committed to protecting your personal information 
                                and being transparent about our data practices.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Withdrawal Success Modal -->
        <div id="withdrawalSuccessModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="text-xl font-bold"><i class="fas fa-check-circle mr-2"></i> Withdrawal Successful</h2>
                    <button class="close-modal" onclick="closeWithdrawalSuccessModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="text-center py-6">
                        <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-green-600 rounded-full flex items-center justify-center mx-auto mb-6">
                            <i class="fas fa-check text-3xl text-white"></i>
                        </div>
                        
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">Withdrawal Request Submitted!</h3>
                        
                        <div class="bg-green-50 p-4 rounded-xl border border-green-200 mb-6">
                            <p class="text-gray-600 mb-2">Amount</p>
                            <p class="text-3xl font-bold text-green-600" id="withdrawal-success-amount">‚Çπ0.00</p>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-xl border border-blue-200">
                            <i class="fas fa-clock text-blue-500 text-xl mb-2"></i>
                            <p class="text-blue-700 font-semibold">Your money will be credited within</p>
                            <p class="text-blue-800 text-lg font-bold mt-1">1-2 Working Days</p>
                            <p class="text-blue-600 text-sm mt-2">to your bank account/UPI</p>
                        </div>
                        
                        <button onclick="closeWithdrawalSuccessModal()" class="btn-primary py-3 px-8 rounded-lg text-lg font-bold w-full mt-6">
                            Continue Earning
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bottom Navigation - Mobile Optimized -->
        <div class="bottom-nav fixed bottom-0 left-0 right-0 flex justify-around p-2 safe-area-bottom">
            <button class="nav-btn active flex flex-col items-center" onclick="showAppSection('home')">
                <i class="fas fa-home text-base mb-1"></i>
                <span class="text-xs">Home</span>
            </button>
            <button class="nav-btn flex flex-col items-center" onclick="showAppSection('convert')">
                <i class="fas fa-exchange-alt text-base mb-1"></i>
                <span class="text-xs">Convert</span>
            </button>
            <button class="nav-btn flex flex-col items-center" onclick="showAppSection('wallet')">
                <i class="fas fa-wallet text-base mb-1"></i>
                <span class="text-xs">Wallet</span>
            </button>
            <button class="nav-btn flex flex-col items-center" onclick="showAppSection('profile')">
                <i class="fas fa-user text-base mb-1"></i>
                <span class="text-xs">Profile</span>
            </button>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCdqZk5dGEijeNh0pFWTSdHAtN8rJLpCWE",
            authDomain: "tez-earn-money-a4451.firebaseapp.com",
            databaseURL: "https://tez-earn-money-a4451-default-rtdb.firebaseio.com",
            projectId: "tez-earn-money-a4451",
            storageBucket: "tez-earn-money-a4451.firebasestorage.app",
            messagingSenderId: "233992005965",
            appId: "1:233992005965:web:6e4d8f5ad9ef4ebc086f04"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // User data - points and balance
        let userData = {
            points: 0,
            balance: 0.00
        };

        // Ad Timer Variables
        let adTimerInterval;
        let adSeconds = 20;
        let adCompleted = false;
        let adPoints = 100;
        let currentAdType = 'smartlink'; // 'smartlink' or 'special'

        // Rewarded Ad - Simplified without AdMob
        let rewardedAdLoaded = true;

        function showRewardedAd(onComplete) {
            console.log('üé¨ Showing Rewarded Ad...');
            showToast('üì± Rewarded ad completed', 'info');
            setTimeout(() => {
                if (onComplete) onComplete();
            }, 1000);
        }

        // Interstitial Ad - Simplified without AdMob
        let interstitialAdLoaded = true;
        let interstitialAdCounter = 0;
        const INTERSTITIAL_AD_FREQUENCY = 3;

        function showInterstitialAd(onComplete) {
            console.log('üì± Interstitial ad skipped');
            if (onComplete) onComplete();
        }

        function checkAndShowInterstitialAd() {
            interstitialAdCounter++;
            
            if (interstitialAdCounter >= INTERSTITIAL_AD_FREQUENCY) {
                interstitialAdCounter = 0;
                
                if (Math.random() < 0.7) {
                    setTimeout(() => {
                        showInterstitialAd(() => {
                            console.log('‚úÖ Interstitial ad completed');
                        });
                    }, 500);
                }
            }
        }

        // NEW: Smartlink Ad Function - Direct Rewarded Ad
        function startSmartlinkAd() {
            if (!checkSmartlinkLimit()) {
                showToast('Daily Watch Ads limit reached (20/20)! Come back tomorrow.', 'error');
                return;
            }

            currentAdType = 'smartlink';
            adPoints = 100;
            
            // Directly show rewarded ad and give points
            showRewardedAd(() => {
                // Award points immediately after ad
                addPoints(adPoints);
                incrementSmartlinkCount();
                updateAdCounts();
                
                // Add to transaction history
                const transactionList = document.getElementById('transaction-list');
                const li = document.createElement('li');
                li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                li.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 text-sm">Earned ${adPoints} points from Watch Ads</p>
                        <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                    </div>
                    <span class="text-green-500 font-bold text-sm ml-2">+${adPoints} pts</span>
                `;
                if (transactionList) {
                    transactionList.prepend(li);
                }
                
                showToast(`üéâ You earned ${adPoints} points!`, 'success');
                
                // Check and possibly show interstitial ad
                checkAndShowInterstitialAd();
            });
        }

        // NEW: Special Offers Function - Direct Rewarded Ad
        function startSpecialOffer() {
            if (!checkSpecialOfferLimit()) {
                showToast('Daily Special Offers limit reached (30/30)! Come back tomorrow.', 'error');
                return;
            }

            currentAdType = 'special';
            adPoints = 200;
            
            // Directly show rewarded ad and give points
            showRewardedAd(() => {
                // Award points immediately after ad
                addPoints(adPoints);
                incrementSpecialOfferCount();
                updateAdCounts();
                
                // Add to transaction history
                const transactionList = document.getElementById('transaction-list');
                const li = document.createElement('li');
                li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                li.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 text-sm">Earned ${adPoints} points from Special Offer</p>
                        <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                    </div>
                    <span class="text-green-500 font-bold text-sm ml-2">+${adPoints} pts</span>
                `;
                if (transactionList) {
                    transactionList.prepend(li);
                }
                
                showToast(`üéâ You earned ${adPoints} points!`, 'success');
                
                // Check and possibly show interstitial ad
                checkAndShowInterstitialAd();
            });
        }

        // Special Offer Timer with Overlay
        let specialOfferTimerInterval;
        let specialOfferSeconds = 20;

        function startSpecialOfferTimer() {
            specialOfferSeconds = 20;
            document.getElementById('overlayTimerDisplay').textContent = specialOfferSeconds;
            document.getElementById('cutButton').classList.remove('visible');
            document.getElementById('timerOverlay').classList.remove('completed');
            
            // Show the overlay
            document.getElementById('adIframeOverlay').classList.add('active');
            document.getElementById('adIframe').src = 'https://www.google.com';
            document.body.style.overflow = 'hidden';
            
            clearInterval(specialOfferTimerInterval);
            
            specialOfferTimerInterval = setInterval(() => {
                specialOfferSeconds--;
                document.getElementById('overlayTimerDisplay').textContent = specialOfferSeconds;
                
                if (specialOfferSeconds <= 0) {
                    clearInterval(specialOfferTimerInterval);
                    // Timer complete - show Cut button
                    document.getElementById('cutButton').classList.add('visible');
                    document.getElementById('timerOverlay').classList.add('completed');
                }
            }, 1000);
        }

        function claimSpecialOfferReward() {
            clearInterval(specialOfferTimerInterval);
            
            // Award points
            addPoints(adPoints);
            incrementSpecialOfferCount();
            updateAdCounts();
            
            // Add to transaction history
            const transactionList = document.getElementById('transaction-list');
            const li = document.createElement('li');
            li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
            li.innerHTML = `
                <div class="flex-1">
                    <p class="font-semibold text-gray-800 text-sm">Earned ${adPoints} points from Special Offer</p>
                    <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                </div>
                <span class="text-green-500 font-bold text-sm ml-2">+${adPoints} pts</span>
            `;
            if (transactionList) {
                transactionList.prepend(li);
            }
            
            showToast(`üéâ You earned ${adPoints} points!`, 'success');
            
            // Close overlay
            closeSpecialOfferOverlay();
        }

        function closeSpecialOfferOverlay() {
            document.getElementById('adIframeOverlay').classList.remove('active');
            document.getElementById('adIframe').src = 'about:blank';
            document.body.style.overflow = 'auto';
            clearInterval(specialOfferTimerInterval);
        }

        function startAdTimerWithType(title, points, type) {
            // Reset ad state
            adSeconds = 20;
            adCompleted = false;
            
            // Show ad timer modal
            document.getElementById('adTimerModal').classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Update UI
            document.getElementById('adModalTitle').textContent = title;
            document.getElementById('rewardPoints').textContent = points;
            document.getElementById('adTimerDisplay').textContent = adSeconds;
            document.getElementById('adTimerProgress').style.width = '0%';
            document.getElementById('adCompleteMessage').classList.remove('active');
            document.getElementById('adContentText').textContent = 'Advertisement Loading...';
            document.getElementById('adCompleteCloseBtn').style.display = 'none';
            document.getElementById('adModalCloseX').style.display = 'block';
            
            // Load random ad content
            loadRandomAdContent();
            
            // Start timer
            startAdTimer();
        }

        function startAdTimer() {
            clearInterval(adTimerInterval);
            
            adTimerInterval = setInterval(() => {
                adSeconds--;
                
                // Update timer display
                document.getElementById('adTimerDisplay').textContent = adSeconds;
                
                // Update progress bar
                const progress = ((20 - adSeconds) / 20) * 100;
                document.getElementById('adTimerProgress').style.width = progress + '%';
                
                // Change ad content periodically
                if (adSeconds % 4 === 0) {
                    loadRandomAdContent();
                }
                
                // Timer completed
                if (adSeconds <= 0) {
                    completeAd();
                }
            }, 1000);
        }

        function loadRandomAdContent() {
            const adContents = [
                { emoji: 'üõí', text: 'Amazing Shopping Deals! Up to 70% OFF' },
                { emoji: 'üéÆ', text: 'New Mobile Game - Download Now!' },
                { emoji: 'üì±', text: 'Latest Smartphone Offers' },
                { emoji: 'üí≥', text: 'Credit Card with Zero Fees' },
                { emoji: '‚úàÔ∏è', text: 'Travel Deals - Book Now & Save!' },
                { emoji: 'üè†', text: 'Home Loan at Low Interest Rates' },
                { emoji: 'üöó', text: 'Car Insurance - Compare & Save' },
                { emoji: 'üõçÔ∏è', text: 'Flash Sale - Limited Time Offer!' }
            ];
            
            const randomAd = adContents[Math.floor(Math.random() * adContents.length)];
            document.getElementById('adContentText').innerHTML = 
                `<div style="font-size: 32px; margin-bottom: 10px;">${randomAd.emoji}</div>
                 <div>${randomAd.text}</div>`;
        }

        function completeAd() {
            clearInterval(adTimerInterval);
            adCompleted = true;
            
            // Hide X button, show cut button
            document.getElementById('adModalCloseX').style.display = 'none';
            document.getElementById('adCompleteCloseBtn').style.display = 'flex';
            
            // Show completion message
            document.getElementById('earnedPointsText').textContent = adPoints;
            document.getElementById('adCompleteMessage').classList.add('active');
            
            // Add points to user
            addPoints(adPoints);
            
            // Increment ad count based on type
            if (currentAdType === 'smartlink') {
                incrementSmartlinkCount();
            } else if (currentAdType === 'special') {
                incrementSpecialOfferCount();
            }
            
            // Update display counts
            updateAdCounts();
            
            // Add to transaction history
            const transactionList = document.getElementById('transaction-list');
            const li = document.createElement('li');
            li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
            const adTypeName = currentAdType === 'smartlink' ? 'Watch Ads' : 'Special Offer';
            li.innerHTML = `
                <div class="flex-1">
                    <p class="font-semibold text-gray-800 text-sm">Earned ${adPoints} points from ${adTypeName}</p>
                    <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                </div>
                <span class="text-green-500 font-bold text-sm ml-2">+${adPoints} pts</span>
            `;
            if (transactionList) {
                transactionList.prepend(li);
            }
            
            showToast(`üéâ You earned ${adPoints} points!`, 'success');
        }

        function closeAdTimer() {
            clearInterval(adTimerInterval);
            document.getElementById('adTimerModal').classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Reset buttons
            document.getElementById('adCompleteCloseBtn').style.display = 'none';
            document.getElementById('adModalCloseX').style.display = 'block';
            
            // Agar timer complete nahi hua aur user close kare to points nahi dena
            if (!adCompleted && adSeconds > 0) {
                showToast('Timer not completed. No points awarded.', 'error');
            }
        }

        // Smartlink Ad Limit Management (20 per day)
        function checkSmartlinkLimit() {
            const user = auth.currentUser;
            if (!user) return true;
            
            const today = new Date().toDateString();
            const smartlinkHistory = JSON.parse(localStorage.getItem(`smartlink_${user.uid}`) || '{}');
            
            if (smartlinkHistory.date !== today) {
                smartlinkHistory.date = today;
                smartlinkHistory.count = 0;
                localStorage.setItem(`smartlink_${user.uid}`, JSON.stringify(smartlinkHistory));
            }
            
            return smartlinkHistory.count < 20;
        }

        function incrementSmartlinkCount() {
            const user = auth.currentUser;
            if (!user) return;
            
            const smartlinkHistory = JSON.parse(localStorage.getItem(`smartlink_${user.uid}`) || '{}');
            smartlinkHistory.count = (smartlinkHistory.count || 0) + 1;
            localStorage.setItem(`smartlink_${user.uid}`, JSON.stringify(smartlinkHistory));
        }

        function getSmartlinkCount() {
            const user = auth.currentUser;
            if (!user) return 0;
            
            const today = new Date().toDateString();
            const smartlinkHistory = JSON.parse(localStorage.getItem(`smartlink_${user.uid}`) || '{}');
            
            if (smartlinkHistory.date !== today) {
                return 0;
            }
            
            return smartlinkHistory.count || 0;
        }

        // Special Offers Limit Management (30 per day)
        function checkSpecialOfferLimit() {
            const user = auth.currentUser;
            if (!user) return true;
            
            const today = new Date().toDateString();
            const specialHistory = JSON.parse(localStorage.getItem(`specialOffer_${user.uid}`) || '{}');
            
            if (specialHistory.date !== today) {
                specialHistory.date = today;
                specialHistory.count = 0;
                localStorage.setItem(`specialOffer_${user.uid}`, JSON.stringify(specialHistory));
            }
            
            return specialHistory.count < 30;
        }

        function incrementSpecialOfferCount() {
            const user = auth.currentUser;
            if (!user) return;
            
            const specialHistory = JSON.parse(localStorage.getItem(`specialOffer_${user.uid}`) || '{}');
            specialHistory.count = (specialHistory.count || 0) + 1;
            localStorage.setItem(`specialOffer_${user.uid}`, JSON.stringify(specialHistory));
        }

        function getSpecialOfferCount() {
            const user = auth.currentUser;
            if (!user) return 0;
            
            const today = new Date().toDateString();
            const specialHistory = JSON.parse(localStorage.getItem(`specialOffer_${user.uid}`) || '{}');
            
            if (specialHistory.date !== today) {
                return 0;
            }
            
            return specialHistory.count || 0;
        }

        // Update ad counts display
        function updateAdCounts() {
            const smartlinkCount = getSmartlinkCount();
            const specialCount = getSpecialOfferCount();
            
            const watchAdsElement = document.getElementById('watchAdsCount');
            const specialOffersElement = document.getElementById('specialOffersCount');
            
            if (watchAdsElement) {
                watchAdsElement.textContent = `${smartlinkCount}/20 today`;
            }
            if (specialOffersElement) {
                specialOffersElement.textContent = `${specialCount}/30 today`;
            }
        }

        // ‚úÖ FIXED: Minimum conversion points variable
        let minConvertPoints = 10;

        // ‚úÖ NAYA CODE - Har user ka alag spin data
        function getUserSpinLimitData() {
            return {
                dailySpins: 0,
                maxDailySpins: 5,
                lastSpinDate: null
            };
        }

        // ‚úÖ NAYA FUNCTION - Har user ka spin data load karo
        function loadUserSpinLimitData(userId) {
            return new Promise((resolve, reject) => {
                db.collection('users').doc(userId).get().then((doc) => {
                    if (doc.exists && doc.data().spinLimitData) {
                        // User ka existing spin data hai
                        const spinData = doc.data().spinLimitData;
                        
                        // Check if it's a new day
                        const today = new Date().toDateString();
                        if (spinData.lastSpinDate !== today) {
                            // Naya din hai, spins reset karo
                            spinData.dailySpins = 0;
                            spinData.lastSpinDate = today;
                            saveUserSpinLimitData(userId, spinData);
                        }
                        
                        resolve(spinData);
                    } else {
                        // Naya user hai, default data banao
                        const defaultSpinData = getUserSpinLimitData();
                        defaultSpinData.lastSpinDate = new Date().toDateString();
                        saveUserSpinLimitData(userId, defaultSpinData);
                        resolve(defaultSpinData);
                    }
                }).catch(error => {
                    reject(error);
                });
            });
        }

        // ‚úÖ NAYA FUNCTION - Har user ka spin data save karo
        function saveUserSpinLimitData(userId, spinData) {
            return db.collection('users').doc(userId).set({
                spinLimitData: spinData
            }, { merge: true });
        }

        // ‚úÖ NAYA FUNCTION: Generate unique referral code
        function generateReferralCode(userId, name = '') {
            // User ID se 6-digit code generate karo
            const baseCode = userId.substring(0, 6).toUpperCase();
            
            // Agar name available hai to first 2 letters add karo
            let namePart = '';
            if (name && name.length >= 2) {
                namePart = name.substring(0, 2).toUpperCase();
            } else {
                namePart = 'TE'; // Default
            }
            
            return `${namePart}${baseCode}`;
        }

        // ‚úÖ NAYA FUNCTION: User ka referral code setup karo
        function setupUserReferralCode(userId, userData) {
            console.log('üîÑ Setting up referral code for user:', userId);
            
            db.collection('users').doc(userId).get().then((doc) => {
                if (doc.exists) {
                    const userDoc = doc.data();
                    
                    let referralCode = userDoc.referralCode;
                    
                    // Agar referral code nahi hai to generate karo
                    if (!referralCode) {
                        referralCode = generateReferralCode(userId, userData.name);
                        
                        // Firestore mein save karo
                        db.collection('users').doc(userId).update({
                            referralCode: referralCode,
                            referralLink: `${window.location.origin}${window.location.pathname}?ref=${referralCode}`,
                            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                        }).then(() => {
                            console.log('‚úÖ Referral code generated:', referralCode);
                            updateReferralDisplay(referralCode, userDoc);
                        });
                    } else {
                        // Agar already hai to display update karo
                        updateReferralDisplay(referralCode, userDoc);
                    }
                }
            }).catch(error => {
                console.error('‚ùå Error setting up referral code:', error);
            });
        }

        // ‚úÖ NAYA FUNCTION: Referral display update karo
        function updateReferralDisplay(referralCode, userData) {
            // Referral code display
            document.getElementById('user-referral-code').textContent = referralCode;
            document.getElementById('profile-referral-code').textContent = referralCode;
            
            // ‚úÖ FIXED: Current page ka use karo referral link ke liye
            const referralLink = `${window.location.origin}${window.location.pathname}?ref=${referralCode}`;
            document.getElementById('referral-link').value = referralLink;
            
            // Referral stats update
            const referralsCount = userData.referrals || 0;
            document.getElementById('total-referrals').textContent = referralsCount;
            document.getElementById('referral-bonus-earned').textContent = 
                `${(referralsCount * 100)} pts`; // 100 points per referral
            document.getElementById('profile-referrals').textContent = referralsCount;
        }

        // ‚úÖ NAYA FUNCTION: Referral code copy karo
        function copyReferralCode() {
            const referralCode = document.getElementById('user-referral-code').textContent;
            
            navigator.clipboard.writeText(referralCode)
                .then(() => showToast('Referral code copied to clipboard!', 'success'))
                .catch(() => showToast('Failed to copy code', 'error'));
        }

        // ‚úÖ NAYA FUNCTION: Referral link copy karo
        function copyReferralLink() {
            const link = document.getElementById('referral-link');
            link.select();
            link.setSelectionRange(0, 99999); // Mobile devices ke liye
            
            try {
                document.execCommand('copy');
                showToast('Referral link copied to clipboard!', 'success');
            } catch (err) {
                // Fallback: Modern clipboard API
                navigator.clipboard.writeText(link.value)
                    .then(() => showToast('Referral link copied!', 'success'))
                    .catch(() => showToast('Failed to copy link', 'error'));
            }
        }

        // ‚úÖ NAYA FUNCTION: WhatsApp pe share karne ke liye - FIXED
        function shareOnWhatsApp() {
            const referralLink = document.getElementById('referral-link').value;
            const referralCode = document.getElementById('user-referral-code').textContent;
            
            // Better message banao
            const message = `üéâ *Tez Earn App* - Paise Kamaye! üí∞\n\n` +
                           `Mera referral code use karo: *${referralCode}*\n\n` +
                           `Yahan signup karo: ${referralLink}\n\n` +
                           `Rozana tasks complete karo, wheel spin karo, aur paise kamao! üöÄ`;
            
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            showToast('WhatsApp share ready!', 'success');
        }

        // ‚úÖ NAYA FUNCTION: Referral system initialize karo
        function initializeReferralSystem() {
            const user = auth.currentUser;
            if (!user) return;
            
            // Referral code setup karo
            db.collection('users').doc(user.uid).get().then((doc) => {
                if (doc.exists) {
                    const userData = doc.data();
                    setupUserReferralCode(user.uid, userData);
                }
            });
            
            // Referral real-time listener
            db.collection('users').doc(user.uid).onSnapshot((doc) => {
                if (doc.exists) {
                    const userData = doc.data();
                    updateReferralDisplay(userData.referralCode, userData);
                }
            }, (error) => {
                console.log('Referral listener connection error (will retry automatically)');
            });
        }

        // ‚úÖ NAYA FUNCTION: Referral tracking aur bonus distribution
        function trackReferral(referralCode) {
            console.log('üéØ Tracking referral with code:', referralCode);
            
            // Referral code se referrer find karo
            db.collection('users')
                .where('referralCode', '==', referralCode)
                .get()
                .then((querySnapshot) => {
                    if (!querySnapshot.empty) {
                        const referrerDoc = querySnapshot.docs[0];
                        const referrerData = referrerDoc.data();
                        const referrerId = referrerDoc.id;
                        
                        console.log('üéØ Referrer found:', referrerData.name);
                        
                        // Current user (jo signup kar raha hai)
                        const currentUser = auth.currentUser;
                        
                        if (currentUser && currentUser.uid !== referrerId) {
                            // Referrer ko bonus points do
                            const referralBonus = 100; // Default bonus
                            
                            // Firestore se current referral bonus get karo
                            db.collection('settings').doc('app').get().then((appDoc) => {
                                let actualBonus = referralBonus;
                                
                                if (appDoc.exists) {
                                    const appSettings = appDoc.data();
                                    actualBonus = appSettings.referralBonus || referralBonus;
                                }
                                
                                // Referrer ko bonus do
                                return db.collection('users').doc(referrerId).update({
                                    points: firebase.firestore.FieldValue.increment(actualBonus),
                                    referrals: firebase.firestore.FieldValue.increment(1),
                                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                                });
                            }).then(() => {
                                console.log('‚úÖ Referral bonus given to referrer');
                                
                                // Transaction history mein add karo
                                const transactionList = document.getElementById('transaction-list');
                                if (transactionList) {
                                    const li = document.createElement('li');
                                    li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                                    li.innerHTML = `
                                        <div class="flex-1">
                                            <p class="font-semibold text-gray-800 text-sm">Referral bonus earned</p>
                                            <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                                        </div>
                                        <span class="text-green-500 font-bold text-sm ml-2">+100 pts</span>
                                    `;
                                    transactionList.prepend(li);
                                }
                                
                                showToast(`üéâ Referral bonus of 100 points claimed!`, 'success');
                            });
                        }
                    } else {
                        console.log('‚ùå No user found with referral code:', referralCode);
                    }
                })
                .catch((error) => {
                    console.error('‚ùå Error tracking referral:', error);
                });
        }

        // ‚úÖ NAYA FUNCTION: URL se referral code check karo
        function checkReferralFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            
            if (refCode) {
                console.log('üéØ Referral code found in URL:', refCode);
                // Store referral code for later use
                localStorage.setItem('pendingReferral', refCode);
                
                // Show referral input field in signup form
                document.getElementById('referral-input-container').classList.remove('hidden');
                document.getElementById('referral-code').value = refCode;
                
                // Show message to user
                showToast(`üéâ You were referred by a friend! Sign up to get bonus.`, 'info');
            }
        }

        // ‚úÖ NAYA FUNCTION: Signup process mein referral apply karo
        function applyReferralOnSignup(userId) {
            const pendingReferral = localStorage.getItem('pendingReferral');
            const referralCodeInput = document.getElementById('referral-code').value;
            
            // Priority: URL parameter > Input field
            const referralCode = pendingReferral || referralCodeInput;
            
            if (referralCode) {
                console.log('üéØ Applying referral for new user:', referralCode);
                trackReferral(referralCode);
                
                // Clear pending referral
                localStorage.removeItem('pendingReferral');
            }
        }

        // ‚úÖ NAYA FUNCTION: Welcome bonus dene ke liye
        function giveWelcomeBonus(userId) {
            console.log('üéÅ Giving welcome bonus to new user:', userId);
            
            // User ko ‚Çπ5 aur 100 points do
            return db.collection('users').doc(userId).update({
                points: 100,
                balance: 5.00,
                hasReceivedWelcomeBonus: true,
                welcomeBonusGivenAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                console.log('‚úÖ Welcome bonus given successfully');
                
                // Update local state
                userData.points = 100;
                userData.balance = 5.00;
                updateDisplays();
                
                // Show welcome bonus popup
                setTimeout(() => {
                    document.getElementById('welcomeBonusPopup').classList.add('active');
                }, 1000);
                
                // Add to transaction history
                const transactionList = document.getElementById('transaction-list');
                const li = document.createElement('li');
                li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                li.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 text-sm">üéÅ Welcome Bonus!</p>
                        <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                    </div>
                    <span class="text-green-500 font-bold text-sm ml-2">+100 pts</span>
                `;
                if (transactionList) {
                    transactionList.prepend(li);
                }
                
                showToast('üéâ Welcome! You received ‚Çπ5 and 100 points bonus!', 'success');
            }).catch((error) => {
                console.error('‚ùå Error giving welcome bonus:', error);
            });
        }

        // ‚úÖ FIXED: Load user data function - Welcome bonus control
        function loadUserData(userId) {
            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (doc.exists) {
                        const userDataFromFirestore = doc.data();
                        
                        // ‚úÖ NAYA CODE: Check if user already received welcome bonus
                        const hasReceivedWelcomeBonus = userDataFromFirestore.hasReceivedWelcomeBonus || false;
                        
                        // Update UI with user data
                        document.getElementById('user-name').textContent = userDataFromFirestore.name;
                        document.getElementById('user-email').textContent = userDataFromFirestore.email;
                        
                        // Set user initials for avatar
                        const initials = userDataFromFirestore.name.split(' ').map(n => n[0]).join('').toUpperCase();
                        document.getElementById('user-initials').textContent = initials;
                        
                        // Update points and balance
                        userData.points = userDataFromFirestore.points || 0;
                        userData.balance = userDataFromFirestore.balance || 0;
                        
                        // ‚úÖ NAYA CODE: Referral code setup karo
                        setupUserReferralCode(userId, userDataFromFirestore);
                        
                        // ‚úÖ NAYA CODE: Agar welcome bonus nahi mila hai to do
                        if (!hasReceivedWelcomeBonus) {
                            giveWelcomeBonus(userId);
                        } else {
                            updateDisplays();
                        }
                        
                        // Initialize spin limit system
                        initializeSpinLimit();
                    } else {
                        // ‚úÖ FIXED: If document doesn't exist, create it with NO welcome bonus initially
                        const user = auth.currentUser;
                        return db.collection('users').doc(userId).set({
                            name: user.displayName || 'User',
                            email: user.email,
                            points: 0, // ‚úÖ Starting with 0 points
                            balance: 0.00, // ‚úÖ Starting with 0 balance
                            hasReceivedWelcomeBonus: false, // ‚úÖ NAYA FIELD: Welcome bonus status
                            referralCode: generateReferralCode(userId, user.displayName || 'User'),
                            referralLink: `${window.location.origin}${window.location.pathname}?ref=${generateReferralCode(userId, user.displayName || 'User')}`,
                            referrals: 0,
                            spinLimitData: {
                                dailySpins: 0,
                                maxDailySpins: 5,
                                lastSpinDate: new Date().toDateString()
                            },
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            level: 'Bronze'
                        }).then(() => {
                            // ‚úÖ NAYA CODE: Ab welcome bonus do
                            giveWelcomeBonus(userId);
                        });
                    }
                })
                .catch((error) => {
                    console.error('Error loading user data:', error);
                });
        }

        // ‚úÖ FIXED: Convert points function with dynamic minimum points
        function convertPoints() {
            const convertAmount = parseInt(document.getElementById('convert-amount').value);
            
            if (isNaN(convertAmount) || convertAmount < minConvertPoints) {
                alert(`Please enter at least ${minConvertPoints} points to convert`);
                return;
            }
            
            if (convertAmount > userData.points) {
                alert('You do not have enough points to convert');
                return;
            }

            // Firestore se current conversion rate get karo
            db.collection('settings').doc('app').get().then((doc) => {
                let conversionRate = 0.1; // Default rate
                
                if (doc.exists) {
                    const appSettings = doc.data();
                    // Extract rate from string like "1 point = ‚Çπ0.1"
                    const rateMatch = appSettings.pointsRate?.match(/‚Çπ(\d+\.?\d*)/);
                    if (rateMatch) {
                        conversionRate = parseFloat(rateMatch[1]);
                    }
                }
                
                const cashAmount = convertAmount * conversionRate;
                
                // Update user data
                userData.points -= convertAmount;
                userData.balance += cashAmount;
                updateDisplays();
                
                // Add to transaction history
                const transactionList = document.getElementById('transaction-list');
                const li = document.createElement('li');
                li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                li.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 text-sm">Converted ${convertAmount} points to cash</p>
                        <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                    </div>
                    <span class="text-blue-500 font-bold text-sm ml-2">-${convertAmount} pts</span>
                `;
                transactionList.prepend(li);
                
                // Clear input field
                document.getElementById('convert-amount').value = '';
                
                showToast(`Successfully converted ${convertAmount} points to ‚Çπ${cashAmount.toFixed(2)}`, 'success');
            });
        }

        // ‚úÖ FIXED: Show app function with conversion settings initialization
        function showApp() {
            document.getElementById('auth').classList.remove('active');
            document.getElementById('app').classList.add('active');
            
            // Update user info in profile
            const user = auth.currentUser;
            if (user) {
                document.getElementById('user-email').textContent = user.email;
                
                // Load user data from Firestore
                loadUserData(user.uid);
                
                // ‚úÖ NAYA LINE: Referral system initialize karo
                initializeReferralSystem();
                
                // ‚úÖ YEH LINE ADD KARO - Real-time listeners start karo
                initializeRealtimeListeners();
                initializeReferralSettings();
                initializeWheelSettings();
                initializeConversionSettings(); // ‚úÖ NAYA LINE ADD KARO - Conversion settings initialize
                
                // ‚úÖ NAYA LINE ADD KARO - Har user ka alag spin limit initialize karo
                initializeSpinLimit();
            }
        }

        // ‚úÖ FIXED: Initialize with conversion settings
        document.addEventListener('DOMContentLoaded', function() {
            updateDisplays();
            showMethodFields();
            loadInitialWheelSettings();
            initializeConversionSettings(); // ‚úÖ NAYA LINE ADD KARO
            
            // ‚úÖ NAYA: Check for referral in URL
            checkReferralFromURL();

            // ‚úÖ NAYA: Welcome bonus popup close button
            document.getElementById('closeBonusPopup').addEventListener('click', function() {
                document.getElementById('welcomeBonusPopup').classList.remove('active');
            });
        });

        // Wheel segments with their point values and angles - DYNAMIC NOW
        let wheelSegments = [];

        // ‚úÖ INITIALIZE SPIN LIMIT FUNCTION KO UPDATE KARO
        function initializeSpinLimit() {
            const user = auth.currentUser;
            if (!user) return;
            
            // Har user ka alag spin data load karo
            loadUserSpinLimitData(user.uid).then(spinLimitData => {
                updateSpinLimitUI(spinLimitData);
            }).catch((error) => {
                console.error('Error loading spin data:', error);
                // Fallback initialization
                const defaultSpinData = getUserSpinLimitData();
                defaultSpinData.lastSpinDate = new Date().toDateString();
                updateSpinLimitUI(defaultSpinData);
            });
        }

        // ‚úÖ UPDATE SPIN LIMIT UI FUNCTION
        function updateSpinLimitUI(spinLimitData) {
            const spinButton = document.querySelector('.spin-button');
            const spinText = document.getElementById('spin-cooldown-text');
            
            if (spinLimitData.dailySpins >= spinLimitData.maxDailySpins) {
                spinButton.disabled = true;
                spinButton.innerHTML = '<i class="fas fa-clock mr-2"></i> DAILY LIMIT REACHED';
                spinText.textContent = `Daily limit reached (${spinLimitData.dailySpins}/${spinLimitData.maxDailySpins})`;
                spinText.classList.add('text-red-500');
            } else {
                spinButton.disabled = false;
                spinButton.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> SPIN NOW';
                spinText.textContent = `Spins today: ${spinLimitData.dailySpins}/${spinLimitData.maxDailySpins}`;
                spinText.classList.remove('text-red-500');
            }
        }

        // ‚úÖ YEH NAYA FUNCTION - Wheel settings ke liye real-time listener
        function initializeWheelSettings() {
            console.log("üéØ Setting up wheel settings listener...");
            
            // Wheel settings changes
            db.collection('settings').doc('wheel').onSnapshot((doc) => {
                if (doc.exists) {
                    const wheelSettings = doc.data();
                    console.log('üéØ Wheel settings updated:', wheelSettings);
                    
                    // Update wheel segments with new points
                    if (wheelSettings.points && wheelSettings.points.length > 0) {
                        updateWheelSegments(wheelSettings.points);
                        showToast('Wheel points updated!', 'success');
                    }
                    
                    // Update segments count if changed
                    if (wheelSettings.segmentsCount) {
                        updateWheelSegmentsCount(wheelSettings.segmentsCount);
                    }

                    // Update spin limit if changed
                    if (wheelSettings.dailySpinLimit) {
                        // Spin limit har user ke liye update hoga
                        const user = auth.currentUser;
                        if (user) {
                            loadUserSpinLimitData(user.uid).then(spinLimitData => {
                                spinLimitData.maxDailySpins = wheelSettings.dailySpinLimit;
                                saveUserSpinLimitData(user.uid, spinLimitData);
                                updateSpinLimitUI(spinLimitData);
                            });
                        }
                    }
                }
            }, (error) => {
                // Silently handle connection errors - Firebase will auto-retry
                console.log('Wheel settings listener reconnecting...');
            });
        }

        // ‚úÖ YEH NAYA FUNCTION - Wheel segments update karna (SVG VERSION)
        function updateWheelSegments(points) {
            const wheel = document.getElementById('wheel');
            if (!wheel) return;
            
            console.log('üîÑ Updating wheel segments with points:', points);
            
            // Get all SVG text elements (segment numbers)
            const textElements = wheel.querySelectorAll('.segment-text');
            
            // Update each text element with the new point values
            points.forEach((point, index) => {
                if (textElements[index]) {
                    textElements[index].textContent = point;
                }
            });
            
            // Update global wheelSegments array
            updateWheelSegmentsArray(points, 360 / points.length);
            
            console.log('‚úÖ Wheel segments updated successfully');
        }

        // ‚úÖ YEH NAYA FUNCTION - Wheel segments array update karna
        function updateWheelSegmentsArray(points, anglePerSegment) {
            wheelSegments = [];
            // ‚úÖ FIXED: SVG segments start at top (270¬∞), so offset by -90¬∞ to align with 0¬∞ = top
            const offsetAngle = -90;
            
            for (let i = 0; i < points.length; i++) {
                wheelSegments.push({
                    points: points[i],
                    startAngle: (i * anglePerSegment) + offsetAngle,
                    endAngle: ((i + 1) * anglePerSegment) + offsetAngle
                });
            }
            console.log('üîÑ Wheel segments array updated:', wheelSegments);
        }

        // ‚úÖ YEH NAYA FUNCTION - Wheel segments count update karna
        function updateWheelSegmentsCount(segmentsCount) {
            console.log('üîÑ Updating wheel segments count to:', segmentsCount);
            
            // Agar points already available hain, use karo, nahi toh default points generate karo
            const defaultPoints = Array.from({length: segmentsCount}, (_, i) => (i + 1) * 10);
            
            // Firestore se current points get karo
            db.collection('settings').doc('wheel').get().then((doc) => {
                if (doc.exists) {
                    const wheelSettings = doc.data();
                    const points = wheelSettings.points || defaultPoints;
                    updateWheelSegments(points);
                } else {
                    updateWheelSegments(defaultPoints);
                }
            });
        }

        // ‚úÖ YEH NAYA FUNCTION - Initial wheel settings load karna
        function loadInitialWheelSettings() {
            console.log("üéØ Loading initial wheel settings...");
            
            db.collection('settings').doc('wheel').get().then((doc) => {
                if (doc.exists) {
                    const wheelSettings = doc.data();
                    console.log('üéØ Initial wheel settings loaded:', wheelSettings);
                    
                    // Update wheel with loaded settings
                    if (wheelSettings.points && wheelSettings.points.length > 0) {
                        updateWheelSegments(wheelSettings.points);
                    } else {
                        // Default wheel settings use karo
                        updateWheelSegments([10, 20, 30, 40, 50, 60]);
                    }
                } else {
                    console.log('‚ÑπÔ∏è No wheel settings found, using defaults');
                    // Default wheel settings use karo
                    updateWheelSegments([10, 20, 30, 40, 50, 60]);
                }
            }).catch((error) => {
                console.error('‚ùå Error loading wheel settings:', error);
                // Fallback to default wheel
                updateWheelSegments([10, 20, 30, 40, 50, 60]);
            });
        }

        // Updated showPointsEarned function for spin
        function showPointsEarned(points, source = 'Spin') {
            // Create modal overlay
            const overlay = document.createElement('div');
            overlay.className = 'fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50';
            
            // Spin wheel winning display
            overlay.innerHTML = `
                <div class="bg-gradient-to-br from-white to-yellow-50 rounded-3xl p-6 max-w-sm w-full mx-4 text-center transform transition-all duration-500 scale-95 animate-scale border-2 border-yellow-300 shadow-2xl">
                    <div class="w-20 h-20 bg-gradient-to-br from-yellow-300 to-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg winner-pulse">
                        <i class="fas fa-trophy text-3xl text-white"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-3">üéâ Congratulations! üéâ</h3>
                    <p class="text-gray-600 mb-2">Wheel stopped at</p>
                    <div class="text-5xl font-bold text-yellow-600 mb-2">${points}</div>
                    <p class="text-xl font-bold text-green-600 mb-4">+${points} Points Earned!</p>
                    <p class="text-sm text-gray-500 mb-4">Points added to your account</p>
                    <button onclick="this.closest('.fixed').remove()" class="btn-primary py-3 px-8 rounded-xl text-lg font-bold w-full">
                        Awesome!
                    </button>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Add animation class after a short delay
            setTimeout(() => {
                overlay.querySelector('.animate-scale').classList.remove('scale-95');
                overlay.querySelector('.animate-scale').classList.add('scale-100');
            }, 10);
        }

        // ‚úÖ YEH NAYA FUNCTION - Referral settings ke liye real-time listener
        function initializeReferralSettings() {
            console.log("üîÑ Setting up referral settings listener...");
            
            // Referral settings changes
            db.collection('settings').doc('app').onSnapshot((doc) => {
                if (doc.exists) {
                    const appSettings = doc.data();
                    console.log('üéØ Referral settings updated:', appSettings);
                    
                    // Update referral bonus points
                    if (appSettings.referralBonus) {
                        document.getElementById('referral-bonus-text').textContent = 
                            `Invite friends and earn ${appSettings.referralBonus} bonus points!`;
                        showToast('Referral bonus updated!', 'success');
                    }

                    // Update app name
                    if (appSettings.appName) {
                        document.getElementById('app-name-header').textContent = appSettings.appName;
                    }

                    // Update conversion rate
                    if (appSettings.pointsRate) {
                        document.getElementById('conversion-rate-text').textContent = appSettings.pointsRate;
                    }

                    // Update withdrawal limits
                    if (appSettings.minWithdrawal) {
                        document.getElementById('withdrawal-amount').min = appSettings.minWithdrawal;
                        document.getElementById('withdrawal-amount').placeholder = 
                            `Enter amount (Min: ‚Çπ${appSettings.minWithdrawal})`;
                        document.getElementById('withdrawal-amount-label').textContent = 
                            `Amount (Min: ‚Çπ${appSettings.minWithdrawal})`;
                    }

                    if (appSettings.maxWithdrawal) {
                        document.getElementById('withdrawal-amount').max = appSettings.maxWithdrawal;
                    }
                }
            }, (error) => {
                // Silently handle connection errors - Firebase will auto-retry
                console.log('Referral settings listener reconnecting...');
            });
        }

        // ‚úÖ YEH NAYA FUNCTION - Referral bonus claim karna
        function claimReferralBonus(referredUserId) {
            // Firestore se current referral bonus get karo
            db.collection('settings').doc('app').get().then((doc) => {
                let referralBonus = 100; // Default bonus
                
                if (doc.exists) {
                    const appSettings = doc.data();
                    referralBonus = appSettings.referralBonus || 100;
                }
                
                // Referrer ko bonus points do
                const user = auth.currentUser;
                if (user) {
                    db.collection('users').doc(user.uid).update({
                        points: firebase.firestore.FieldValue.increment(referralBonus),
                        referrals: firebase.firestore.FieldValue.increment(1)
                    }).then(() => {
                        // Transaction history mein add karo
                        const transactionList = document.getElementById('transaction-list');
                        const li = document.createElement('li');
                        li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                        li.innerHTML = `
                            <div class="flex-1">
                                <p class="font-semibold text-gray-800 text-sm">Referral bonus earned</p>
                                <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                            </div>
                            <span class="text-green-500 font-bold text-sm ml-2">+${referralBonus} pts</span>
                        `;
                        transactionList.prepend(li);
                        
                        showToast(`üéâ Referral bonus of ${referralBonus} points claimed!`, 'success');
                    });
                }
            });
        }

        // ‚úÖ YEH NAYA FUNCTION - Real-time updates ke liye
        function initializeRealtimeListeners() {
            console.log("üîÑ Setting up real-time listeners...");
            
            // Tasks changes
            db.collection('tasks').where('status', '==', 'active').onSnapshot((snapshot) => {
                console.log('üìù Tasks updated! Total active tasks: ' + snapshot.size);
                showToast('New tasks available! Check them out.', 'info');
            }, (error) => {
                // Silently handle connection errors - Firebase will auto-retry
                console.log('Tasks listener reconnecting...');
            });

            // ‚úÖ YEH NAYA - Withdrawals ke liye listener
            const user = auth.currentUser;
            if (user) {
                // Temporary fix - remove ordering until index is created
                db.collection('withdrawals')
                    .where('userId', '==', user.uid)
                    .onSnapshot((snapshot) => {
                        console.log('üí∞ Withdrawals updated:', snapshot.size);
                        
                        // Manual sorting
                        const withdrawals = [];
                        snapshot.forEach(doc => {
                            withdrawals.push({
                                id: doc.id,
                                ...doc.data()
                            });
                        });
                        
                        // Sort by date manually
                        withdrawals.sort((a, b) => {
                            return new Date(b.createdAt?.toDate() || 0) - new Date(a.createdAt?.toDate() || 0);
                        });
                        
                        updateWithdrawalsDisplay(withdrawals);
                    }, (error) => {
                        // Silently handle connection errors - Firebase will auto-retry
                        console.log('Withdrawals listener reconnecting...');
                    });
            }
        }

        // ‚úÖ YEH NAYA FUNCTION - Withdrawals display update
        function updateWithdrawalsDisplay(withdrawals) {
            const transactionList = document.getElementById('transaction-list');
            if (!transactionList) return;

            // Clear existing transactions
            transactionList.innerHTML = '';

            withdrawals.forEach((withdrawal) => {
                const li = document.createElement('li');
                li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                
                let statusClass = 'text-blue-500';
                let statusText = 'Pending';
                
                if (withdrawal.status === 'approved') {
                    statusClass = 'text-green-500';
                    statusText = 'Approved';
                } else if (withdrawal.status === 'rejected') {
                    statusClass = 'text-red-500';
                    statusText = 'Rejected';
                }
                
                li.innerHTML = `
                    <div class="flex-1">
                        <p class="font-semibold text-gray-800 text-sm">Withdrawal ‚Çπ${withdrawal.amount} - ${statusText}</p>
                        <p class="text-gray-500 text-xs mt-1">${withdrawal.createdAt ? withdrawal.createdAt.toDate().toISOString().split('T')[0] : 'N/A'}</p>
                        <p class="text-gray-500 text-xs mt-1">${withdrawal.method}</p>
                    </div>
                    <span class="${statusClass} font-bold text-sm ml-2">-‚Çπ${withdrawal.amount}</span>
                `;
                transactionList.appendChild(li);
            });
        }

        // ‚úÖ YEH NAYA FUNCTION - Toast messages dikhane ke liye
        function showToast(message, type = 'info') {
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 p-4 rounded-lg text-white z-50 ${
                type === 'success' ? 'bg-green-500' : 
                type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`;
            toast.textContent = message;
            
            // Add to page
            document.body.appendChild(toast);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Auth Functions
        function showLoginForm() {
            document.getElementById('login-form').classList.remove('hidden');
            document.getElementById('signup-form').classList.add('hidden');
            document.getElementById('forget-password-page').classList.remove('active');
            document.getElementById('auth').classList.add('active');
            clearAuthErrors();
        }

        function showSignupForm() {
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('signup-form').classList.remove('hidden');
            document.getElementById('forget-password-page').classList.remove('active');
            document.getElementById('auth').classList.add('active');
            clearAuthErrors();
        }

        // ‚úÖ NAYA FUNCTION: Show Forget Password Page
        function showForgetPasswordPage() {
            document.getElementById('auth').classList.remove('active');
            document.getElementById('app').classList.remove('active');
            document.getElementById('forget-password-page').classList.add('active');
            clearAuthErrors();
        }

        function clearAuthErrors() {
            // Clear all error messages
            document.querySelectorAll('.error-message').forEach(el => {
                el.classList.add('hidden');
                el.textContent = '';
            });
            document.querySelectorAll('.success-message').forEach(el => {
                el.classList.add('hidden');
                el.textContent = '';
            });
        }

        // Login Function
        document.getElementById('login-btn').addEventListener('click', function() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            // Clear previous errors
            clearAuthErrors();
            
            // Validate inputs
            let isValid = true;
            
            if (!email) {
                document.getElementById('login-email-error').textContent = 'Email is required';
                document.getElementById('login-email-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (!password) {
                document.getElementById('login-password-error').textContent = 'Password is required';
                document.getElementById('login-password-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Show loading state
            document.getElementById('login-text').classList.add('hidden');
            document.getElementById('login-loading').classList.remove('hidden');
            document.getElementById('login-btn').disabled = true;
            
            // Sign in with Firebase
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in
                    const user = userCredential.user;
                    document.getElementById('login-message').textContent = 'Login successful!';
                    document.getElementById('login-message').classList.remove('hidden');
                    
                    // Load user data from Firestore
                    loadUserData(user.uid);
                    
                    // Show app after a short delay
                    setTimeout(() => {
                        showApp();
                    }, 1000);
                })
                .catch((error) => {
                    // Handle errors
                    const errorCode = error.code;
                    let errorMessage = 'An error occurred during login';
                    
                    if (errorCode === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email';
                    } else if (errorCode === 'auth/wrong-password') {
                        errorMessage = 'Incorrect password';
                    } else if (errorCode === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address';
                    }
                    
                    document.getElementById('login-message').textContent = errorMessage;
                    document.getElementById('login-message').classList.remove('hidden');
                })
                .finally(() => {
                    // Reset loading state
                    document.getElementById('login-text').classList.remove('hidden');
                    document.getElementById('login-loading').classList.add('hidden');
                    document.getElementById('login-btn').disabled = false;
                });
        });

        // ‚úÖ NAYA FUNCTION: Reset Password Function
        function resetPassword() {
            const email = document.getElementById('reset-email').value;
            
            // Clear previous errors
            clearAuthErrors();
            
            // Validate email
            if (!email) {
                document.getElementById('errorMessage').textContent = 'Email is required';
                document.getElementById('errorMessage').classList.remove('hidden');
                return;
            }
            
            // Email format validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                document.getElementById('errorMessage').textContent = 'Please enter a valid email address';
                document.getElementById('errorMessage').classList.remove('hidden');
                return;
            }
            
            // Show loading state
            document.getElementById('forgot-submit-btn').disabled = true;
            document.getElementById('resetLoader').style.display = 'block';
            
            // Send password reset email
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    document.getElementById('successMessage').textContent = 'Password reset email sent! Check your inbox.';
                    document.getElementById('successMessage').classList.remove('hidden');
                    
                    // Auto redirect to login after 3 seconds
                    setTimeout(() => {
                        showLoginForm();
                    }, 3000);
                })
                .catch((error) => {
                    const errorCode = error.code;
                    let errorMessage = 'An error occurred while sending reset email';
                    
                    if (errorCode === 'auth/user-not-found') {
                        errorMessage = 'No account found with this email address';
                    } else if (errorCode === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address';
                    } else if (errorCode === 'auth/too-many-requests') {
                        errorMessage = 'Too many requests. Please try again later.';
                    }
                    
                    document.getElementById('errorMessage').textContent = errorMessage;
                    document.getElementById('errorMessage').classList.remove('hidden');
                })
                .finally(() => {
                    // Reset loading state
                    document.getElementById('forgot-submit-btn').disabled = false;
                    document.getElementById('resetLoader').style.display = 'none';
                });
        }

        // ‚úÖ FIXED: Signup function - Welcome bonus control
        document.getElementById('signup-btn').addEventListener('click', function() {
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm-password').value;
            
            // Clear previous errors
            clearAuthErrors();
            
            // Validate inputs
            let isValid = true;
            
            if (!name) {
                document.getElementById('signup-name-error').textContent = 'Name is required';
                document.getElementById('signup-name-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (!email) {
                document.getElementById('signup-email-error').textContent = 'Email is required';
                document.getElementById('signup-email-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (!password) {
                document.getElementById('signup-password-error').textContent = 'Password is required';
                document.getElementById('signup-password-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (password.length < 6) {
                document.getElementById('signup-password-error').textContent = 'Password must be at least 6 characters';
                document.getElementById('signup-password-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (password !== confirmPassword) {
                document.getElementById('signup-confirm-password-error').textContent = 'Passwords do not match';
                document.getElementById('signup-confirm-password-error').classList.remove('hidden');
                isValid = false;
            }
            
            if (!isValid) return;
            
            // Show loading state
            document.getElementById('signup-text').classList.add('hidden');
            document.getElementById('signup-loading').classList.remove('hidden');
            document.getElementById('signup-btn').disabled = true;
            
            // Create user with Firebase
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed up
                    const user = userCredential.user;
                    
                    // ‚úÖ NAYA: Referral code generate karo
                    const referralCode = generateReferralCode(user.uid, name);
                    
                    // ‚úÖ FIXED: Save user data to Firestore WITHOUT welcome bonus initially
                    return db.collection('users').doc(user.uid).set({
                        name: name,
                        email: email,
                        points: 0, // ‚úÖ Start with 0 points
                        balance: 0.00, // ‚úÖ Start with 0 balance
                        hasReceivedWelcomeBonus: false, // ‚úÖ NAYA FIELD: Bonus not given yet
                        referralCode: referralCode,
                        referralLink: `${window.location.origin}${window.location.pathname}?ref=${referralCode}`,
                        referrals: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        level: 'Bronze',
                        spinLimitData: {
                            dailySpins: 0,
                            maxDailySpins: 5,
                            lastSpinDate: new Date().toDateString()
                        }
                    });
                })
                .then(() => {
                    // ‚úÖ NAYA: Apply referral if any
                    applyReferralOnSignup(user.uid);
                    
                    document.getElementById('signup-message').textContent = 'Account created successfully!';
                    document.getElementById('signup-message').classList.remove('hidden');
                    
                    // Show app after a short delay
                    setTimeout(() => {
                        showApp();
                    }, 1000);
                })
                .catch((error) => {
                    // Handle errors
                    const errorCode = error.code;
                    let errorMessage = 'An error occurred during signup';
                    
                    if (errorCode === 'auth/email-already-in-use') {
                        errorMessage = 'An account with this email already exists';
                    } else if (errorCode === 'auth/invalid-email') {
                        errorMessage = 'Invalid email address';
                    } else if (errorCode === 'auth/weak-password') {
                        errorMessage = 'Password is too weak';
                    }
                    
                    document.getElementById('signup-message').textContent = errorMessage;
                    document.getElementById('signup-message').classList.remove('hidden');
                })
                .finally(() => {
                    // Reset loading state
                    document.getElementById('signup-text').classList.remove('hidden');
                    document.getElementById('signup-loading').classList.add('hidden');
                    document.getElementById('signup-btn').disabled = false;
                });
        });

        // Save user data to Firestore - FIXED VERSION
        function saveUserData(userId) {
            // First check if document exists
            db.collection('users').doc(userId).get()
                .then((doc) => {
                    if (doc.exists) {
                        // Document exists, update it
                        return db.collection('users').doc(userId).update({
                            points: userData.points,
                            balance: userData.balance,
                            lastActive: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } else {
                        // Document doesn't exist, create it
                        const user = auth.currentUser;
                        return db.collection('users').doc(userId).set({
                            name: user.displayName || 'User',
                            email: user.email,
                            points: userData.points,
                            balance: userData.balance,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                            level: 'Bronze',
                            referrals: 0,
                            lastActive: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                })
                .catch((error) => {
                    console.error('Error saving user data:', error);
                });
        }

        // Update all points and balance displays
        function updateDisplays() {
            // Points displays
            document.getElementById('points-header').textContent = userData.points;
            document.getElementById('points-convert').textContent = userData.points;
            document.getElementById('points-wallet').textContent = userData.points;
            document.getElementById('points-profile').textContent = userData.points;
            
            // Balance displays
            document.getElementById('balance-header').textContent = userData.balance.toFixed(2);
            document.getElementById('balance-convert').textContent = userData.balance.toFixed(2);
            document.getElementById('balance-wallet').textContent = userData.balance.toFixed(2);
            document.getElementById('balance-profile').textContent = userData.balance.toFixed(2);
            
            // Save to Firestore if user is logged in - BUT ONLY IF DATA CHANGED
            const user = auth.currentUser;
            if (user) {
                // Use setTimeout to avoid multiple rapid calls
                clearTimeout(window.saveUserDataTimeout);
                window.saveUserDataTimeout = setTimeout(() => {
                    saveUserData(user.uid);
                }, 500);
            }
        }

        // Function to show appropriate fields based on withdrawal method
        function showMethodFields() {
            const method = document.getElementById('withdrawal-method').value;
            
            // Hide all method fields first
            document.querySelectorAll('.method-fields').forEach(field => {
                field.classList.add('hidden');
            });
            
            // Show the appropriate fields based on selected method
            if (method === 'upi') {
                document.getElementById('upi-fields').classList.remove('hidden');
            } else if (method === 'paytm') {
                document.getElementById('paytm-fields').classList.remove('hidden');
            } else if (method === 'bank') {
                document.getElementById('bank-fields').classList.remove('hidden');
            }
        }

        // Function to play tick sound using Web Audio API - Fixed for multiple spins
        let audioContext = null;
        
        function playTickSound() {
            try {
                // Create a new audio context if it doesn't exist or is closed
                if (!audioContext || audioContext.state === 'closed') {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                // Resume context if suspended (important for mobile browsers)
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.value = 800; // Tick frequency
                oscillator.type = 'square';
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.05);
            } catch (error) {
                console.error('Audio playback error:', error);
            }
        }

        // Professional Spin Wheel Functionality - FIXED with daily limit and TICK SOUND
        let isSpinning = false;
        let spinCountForAd = 0; // Track spins for rewarded ad (every 5 spins)
        
        function spin() {
            if (isSpinning) return;
            
            const user = auth.currentUser;
            if (!user) return;
            
            // Har user ka alag spin data load karo
            loadUserSpinLimitData(user.uid).then(spinLimitData => {
                // Check daily spin limit
                if (spinLimitData.dailySpins >= spinLimitData.maxDailySpins) {
                    showToast('Daily spin limit reached! Come back tomorrow.', 'error');
                    return;
                }
                
                isSpinning = true;
                
                const spinButton = document.querySelector('.spin-button');
                spinButton.disabled = true;
                spinButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> SPINNING...';
                
                const wheel = document.getElementById('wheel');
                
                // Reset wheel rotation
                wheel.style.transform = 'rotate(0deg)';
                
                // Check if wheel segments are available
                if (wheelSegments.length === 0) {
                    console.error('‚ùå No wheel segments available');
                    isSpinning = false;
                    spinButton.disabled = false;
                    spinButton.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> SPIN NOW';
                    return;
                }
                
                // ‚úÖ WEIGHTED PROBABILITY - Lower points zyada aayenge, higher points kam (10%)
                // First, find the median point value to classify low vs high
                const allPoints = wheelSegments.map(seg => seg.points).sort((a, b) => a - b);
                const medianPoint = allPoints[Math.floor(allPoints.length / 2)];
                
                // Assign weights: low points get 90% total probability, high points get 10%
                const lowSegments = wheelSegments.filter(seg => seg.points <= medianPoint);
                const highSegments = wheelSegments.filter(seg => seg.points > medianPoint);
                
                // If all segments are same, use equal probability
                const totalLowWeight = lowSegments.length > 0 ? 90 : 50;
                const totalHighWeight = highSegments.length > 0 ? 10 : 50;
                
                // Create weighted array with probabilities
                const weightedSegments = wheelSegments.map(segment => {
                    const isLowPoint = segment.points <= medianPoint;
                    const segmentGroup = isLowPoint ? lowSegments : highSegments;
                    const groupWeight = isLowPoint ? totalLowWeight : totalHighWeight;
                    const weight = segmentGroup.length > 0 ? groupWeight / segmentGroup.length : 1;
                    
                    return {
                        segment: segment,
                        weight: weight,
                        index: wheelSegments.indexOf(segment)
                    };
                });
                
                // Calculate total weight for normalization
                const totalWeight = weightedSegments.reduce((sum, item) => sum + item.weight, 0);
                
                // Generate random number between 0 and totalWeight
                const randomValue = Math.random() * totalWeight;
                
                // Select segment based on weighted probability
                let cumulativeWeight = 0;
                let selectedSegmentIndex = 0;
                
                for (let i = 0; i < weightedSegments.length; i++) {
                    cumulativeWeight += weightedSegments[i].weight;
                    if (randomValue <= cumulativeWeight) {
                        selectedSegmentIndex = weightedSegments[i].index;
                        break;
                    }
                }
                
                const selectedSegment = wheelSegments[selectedSegmentIndex];
                
                // Calculate the middle angle of the selected segment
                const segmentMiddleAngle = (selectedSegment.startAngle + selectedSegment.endAngle) / 2;
                
                // ‚úÖ FIXED: Arrow is at top (270¬∞) pointing down at the wheel
                // We want the segment's middle angle to align with 270¬∞ (where arrow points)
                const arrowAngle = 270; // Arrow at top-center
                const targetRotation = arrowAngle - segmentMiddleAngle;
                
                // Add multiple full rotations for a spinning effect (5 full rotations = 1800 degrees)
                const fullRotations = 5 * 360;
                const finalRotation = fullRotations + targetRotation;
                
                // Set the final rotation as a CSS variable
                wheel.style.setProperty('--final-rotation', `${finalRotation}deg`);
                
                // Remove any existing spinning class
                wheel.classList.remove('spinning');
                
                // Force reflow to restart animation
                void wheel.offsetWidth;
                
                // Start spinning with animation
                wheel.classList.add('spinning');
                
                // Show glow effect
                const glow = document.querySelector('.wheel-glow');
                glow.style.opacity = '1';
                
                // ‚úÖ TICK TICK SOUND - Play tick sound repeatedly during spin
                let tickCount = 0;
                const totalTicks = 40; // Number of ticks during spin
                const tickInterval = 4000 / totalTicks; // Spread ticks over 4 seconds
                
                const tickTimer = setInterval(() => {
                    playTickSound();
                    tickCount++;
                    if (tickCount >= totalTicks) {
                        clearInterval(tickTimer);
                    }
                }, tickInterval);
                
                setTimeout(() => {
                    wheel.classList.remove('spinning');
                    isSpinning = false;
                    
                    // ‚úÖ YEH LINE CHANGE KARO - Har user ka alag spin count update karo
                    spinLimitData.dailySpins++;
                    spinLimitData.lastSpinDate = new Date().toDateString();
                    
                    // Increment spin counter for rewarded ad
                    spinCountForAd++;
                    
                    // Har user ka alag spin data save karo
                    saveUserSpinLimitData(user.uid, spinLimitData).then(() => {
                        updateSpinLimitUI(spinLimitData);
                        
                        // Hide glow effect
                        glow.style.opacity = '0';
                        
                        // Show the winning points - EXACTLY THE NUMBER AT THE ARROW
                        showPointsEarned(selectedSegment.points);
                        addPoints(selectedSegment.points);
                        
                        // Check and possibly show interstitial ad
                        checkAndShowInterstitialAd();
                        
                        // Check if 5 spins completed - show rewarded ad
                        if (spinCountForAd >= 5) {
                            spinCountForAd = 0; // Reset counter
                            
                            // Show rewarded ad after a short delay
                            setTimeout(() => {
                                showToast('5 spins completed! Watch ad for bonus points', 'info');
                                showRewardedAd(() => {
                                    // Give bonus points after watching ad
                                    const bonusPoints = 50;
                                    addPoints(bonusPoints);
                                    showToast(`Bonus +${bonusPoints} points earned!`, 'success');
                                });
                            }, 2000);
                        }
                    });
                }, 4000);
                
            }).catch(error => {
                console.error('Error loading spin data:', error);
                isSpinning = false;
            });
        }

        // Add points to user account
        function addPoints(points) {
            userData.points += points;
            updateDisplays();
            
            // Add to transaction history
            const transactionList = document.getElementById('transaction-list');
            const li = document.createElement('li');
            li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
            li.innerHTML = `
                <div class="flex-1">
                    <p class="font-semibold text-gray-800 text-sm">Earned ${points} points from Spin</p>
                    <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                </div>
                <span class="text-green-500 font-bold text-sm ml-2">+${points} pts</span>
            `;
            transactionList.prepend(li);
        }

        // Updated withdrawal submission function - FIXED VERSION with Success Popup
        function submitWithdrawal() {
            const amount = parseFloat(document.getElementById('withdrawal-amount').value);
            const method = document.getElementById('withdrawal-method');
            const methodText = method.options[method.selectedIndex].text;
            
            // ‚úÖ YEH NAYA - Firestore se current min/max withdrawal get karo
            db.collection('settings').doc('app').get().then((doc) => {
                let minWithdrawal = 100; // Default
                let maxWithdrawal = 5000; // Default
                
                if (doc.exists) {
                    const appSettings = doc.data();
                    minWithdrawal = appSettings.minWithdrawal || 100;
                    maxWithdrawal = appSettings.maxWithdrawal || 5000;
                }
                
                // Validate amount with dynamic min/max
                if (amount < minWithdrawal) {
                    alert(`Minimum withdrawal amount is ‚Çπ${minWithdrawal}`);
                    return;
                }
                
                if (amount > maxWithdrawal) {
                    alert(`Maximum withdrawal amount is ‚Çπ${maxWithdrawal}`);
                    return;
                }
                
                if (amount > userData.balance) {
                    alert('You do not have enough balance to withdraw this amount');
                    return;
                }
                
                // Validate method-specific fields
                let methodDetails = '';
                let details = '';
                
                if (method.value === 'upi') {
                    const upiId = document.getElementById('upi-id').value;
                    if (!upiId) {
                        alert('Please enter your UPI ID');
                        return;
                    }
                    methodDetails = `UPI ID: ${upiId}`;
                    details = upiId;
                } else if (method.value === 'paytm') {
                    const paytmNumber = document.getElementById('paytm-number').value;
                    if (!paytmNumber) {
                        alert('Please enter your Paytm number');
                        return;
                    }
                    methodDetails = `Paytm Number: ${paytmNumber}`;
                    details = paytmNumber;
                } else if (method.value === 'bank') {
                    const accountHolder = document.getElementById('account-holder').value;
                    const accountNumber = document.getElementById('account-number').value;
                    const ifscCode = document.getElementById('ifsc-code').value;
                    
                    if (!accountHolder || !accountNumber || !ifscCode) {
                        alert('Please fill all bank details');
                        return;
                    }
                    methodDetails = `Account: ${accountNumber}, IFSC: ${ifscCode}`;
                    details = `${accountHolder} - ${accountNumber} - ${ifscCode}`;
                }
                
                const user = auth.currentUser;
                if (!user) {
                    alert('Please login first');
                    return;
                }

                // Firestore me withdrawal save karo
                db.collection('withdrawals').add({
                    userId: user.uid,
                    userName: document.getElementById('user-name').textContent || 'User',
                    userEmail: user.email,
                    amount: amount,
                    method: method.value,
                    details: details,
                    status: 'pending',
                    createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                    processedAt: null
                }).then(() => {
                    // Update user data
                    userData.balance -= amount;
                    updateDisplays();
                    
                    // Add to transaction history
                    const transactionList = document.getElementById('transaction-list');
                    const li = document.createElement('li');
                    li.className = 'p-3 rounded-lg bg-white border border-gray-200 flex justify-between items-center';
                    li.innerHTML = `
                        <div class="flex-1">
                            <p class="font-semibold text-gray-800 text-sm">Withdrew ‚Çπ${amount} to ${methodText}</p>
                            <p class="text-gray-500 text-xs mt-1">${new Date().toISOString().split('T')[0]}</p>
                            <p class="text-gray-500 text-xs mt-1">${methodDetails}</p>
                        </div>
                        <span class="text-red-500 font-bold text-sm ml-2">-‚Çπ${amount}</span>
                    `;
                    transactionList.prepend(li);
                    
                    // ‚úÖ NAYA: Show withdrawal success popup
                    showWithdrawalSuccessModal(amount);
                    
                    // Clear form fields
                    document.getElementById('withdrawal-amount').value = '';
                    document.getElementById('upi-id').value = '';
                    document.getElementById('paytm-number').value = '';
                    document.getElementById('account-holder').value = '';
                    document.getElementById('account-number').value = '';
                    document.getElementById('ifsc-code').value = '';
                    
                }).catch((error) => {
                    console.error('Error saving withdrawal:', error);
                    alert('Error submitting withdrawal: ' + error.message);
                });
            });
        }

        // ‚úÖ NAYA FUNCTION: Show withdrawal success modal
        function showWithdrawalSuccessModal(amount) {
            const modal = document.getElementById('withdrawalSuccessModal');
            const amountElement = document.getElementById('withdrawal-success-amount');
            
            // Set the withdrawal amount
            amountElement.textContent = `‚Çπ${amount.toFixed(2)}`;
            
            // Show the modal
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';
            
            // Add animation class
            const modalContent = modal.querySelector('.modal-content');
            modalContent.classList.add('withdrawal-success-animation');
        }

        // ‚úÖ NAYA FUNCTION: Close withdrawal success modal
        function closeWithdrawalSuccessModal() {
            const modal = document.getElementById('withdrawalSuccessModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            // Remove animation class
            const modalContent = modal.querySelector('.modal-content');
            modalContent.classList.remove('withdrawal-success-animation');
        }

        // Placeholder Functions
        function watchAds() {
            alert("Redirecting to watch ads...");
        }

        // Logout function
        function logout() {
            auth.signOut().then(() => {
                // Sign-out successful
                document.getElementById('app').classList.remove('active');
                document.getElementById('auth').classList.add('active');
                showLoginForm();
                
                // Clear form fields
                document.getElementById('login-email').value = '';
                document.getElementById('login-password').value = '';
                document.getElementById('signup-name').value = '';
                document.getElementById('signup-email').value = '';
                document.getElementById('signup-password').value = '';
                document.getElementById('signup-confirm-password').value = '';
                document.getElementById('referral-code').value = '';
                document.getElementById('reset-email').value = '';
            }).catch((error) => {
                console.error('Logout error:', error);
            });
        }

        // Reset password function
        function resetPassword() {
            const user = auth.currentUser;
            const email = user ? user.email : prompt('Please enter your email address:');
            
            if (!email) return;
            
            auth.sendPasswordResetEmail(email)
                .then(() => {
                    alert('Password reset email sent! Check your inbox.');
                })
                .catch((error) => {
                    console.error('Password reset error:', error);
                    alert('Error sending password reset email: ' + error.message);
                });
        }

        // Show About Modal
        function showAbout() {
            document.getElementById('aboutModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close About Modal
        function closeAbout() {
            document.getElementById('aboutModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Show Privacy Policy Modal
        function showPrivacyPolicy() {
            document.getElementById('privacyModal').classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Close Privacy Policy Modal
        function closePrivacyPolicy() {
            document.getElementById('privacyModal').classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Open Support
        function openSupport() {
            const supportUrl = 'mailto:rgstudiopvtltd@gmail.com';
            window.open(supportUrl, '_blank');
        }

        // Open Telegram
        function openTelegram() {
            const telegramUrl = 'https://t.me/rgstudiopvtltd';
            window.open(telegramUrl, '_blank');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const aboutModal = document.getElementById('aboutModal');
            const privacyModal = document.getElementById('privacyModal');
            const withdrawalSuccessModal = document.getElementById('withdrawalSuccessModal');
            const adTimerModal = document.getElementById('adTimerModal');
            const welcomeBonusPopup = document.getElementById('welcomeBonusPopup');
            
            if (event.target === aboutModal) {
                closeAbout();
            }
            if (event.target === privacyModal) {
                closePrivacyPolicy();
            }
            if (event.target === withdrawalSuccessModal) {
                closeWithdrawalSuccessModal();
            }
            if (event.target === adTimerModal) {
                closeAdTimer();
            }
            if (event.target === welcomeBonusPopup) {
                welcomeBonusPopup.classList.remove('active');
            }
        }


        // Check auth state on page load
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                showApp();
                // Update ad counts
                updateAdCounts();
            } else {
                // User is signed out
                document.getElementById('app').classList.remove('active');
                document.getElementById('auth').classList.add('active');
                showLoginForm();
            }
        });

        // Fixed App Navigation Functionality
        
        function showAppSection(sectionId) {
            // Hide all app sections
            document.querySelectorAll('.app-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }
            
            // Update navigation buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Find and activate the clicked button
            const activeButton = document.querySelector(`[onclick="showAppSection('${sectionId}')"]`);
            if (activeButton) {
                activeButton.classList.add('active');
            }

            // Scroll to top when changing sections
            window.scrollTo(0, 0);
        }

        // ‚úÖ FIXED: Minimum conversion points ke liye real-time listener
        function initializeConversionSettings() {
            console.log("üîÑ Setting up conversion settings listener...");
            
            // Conversion settings changes
            db.collection('settings').doc('app').onSnapshot((doc) => {
                if (doc.exists) {
                    const appSettings = doc.data();
                    console.log('üéØ Conversion settings updated:', appSettings);
                    
                    // Update minimum conversion points
                    if (appSettings.minConvertPoints) {
                        updateMinConversionPoints(appSettings.minConvertPoints);
                        showToast('Conversion settings updated!', 'success');
                    }
                }
            }, (error) => {
                // Silently handle connection errors - Firebase will auto-retry
                console.log('Conversion settings listener reconnecting...');
            });
        }

        // ‚úÖ FIXED: Minimum conversion points update karna
        function updateMinConversionPoints(minPoints) {
            console.log('üîÑ Updating minimum conversion points to:', minPoints);
            
            // Global variable update
            minConvertPoints = minPoints;
            
            // Update convert amount input placeholder
            const convertInput = document.getElementById('convert-amount');
            if (convertInput) {
                convertInput.placeholder = `Enter points to convert (Min: ${minPoints})`;
                convertInput.min = minPoints;
            }
            
            // Update conversion info text
            const convertInfo = document.getElementById('min-convert-text');
            if (convertInfo) {
                convertInfo.textContent = `Minimum conversion: ${minPoints} points`;
            }
            
            console.log('‚úÖ Minimum conversion points updated successfully');
        }

        // ‚úÖ NAYA: Event listener for reset password button
        document.addEventListener('DOMContentLoaded', function() {
            const forgotPasswordForm = document.getElementById('forgotPasswordForm');
            if (forgotPasswordForm) {
                forgotPasswordForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    resetPassword();
                });
            }
            
            // Enter key support for forgot password form
            const resetEmailInput = document.getElementById('reset-email');
            if (resetEmailInput) {
                resetEmailInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        resetPassword();
                    }
                });
            }
        });

        // Offline/Online Network Detection
        function showOfflineModal() {
            const offlineModal = document.getElementById('offlineModal');
            if (offlineModal) {
                offlineModal.classList.add('active');
            }
        }

        function hideOfflineModal() {
            const offlineModal = document.getElementById('offlineModal');
            if (offlineModal) {
                offlineModal.classList.remove('active');
            }
        }

        function retryConnection() {
            if (navigator.onLine) {
                hideOfflineModal();
                showToast('‚úÖ Connection restored!', 'success');
                // Reload the page to refresh data
                window.location.reload();
            } else {
                showToast('‚ùå Still offline. Please check your connection.', 'error');
            }
        }

        // Listen for online/offline events
        window.addEventListener('online', function() {
            console.log('üåê Connection restored');
            hideOfflineModal();
            showToast('‚úÖ You are back online!', 'success');
        });

        window.addEventListener('offline', function() {
            console.log('üì° Connection lost');
            showOfflineModal();
        });

        // Check connection status on page load
        window.addEventListener('load', function() {
            if (!navigator.onLine) {
                showOfflineModal();
            }
        });

        // Prevent zoom on input focus for better mobile experience
        document.addEventListener('DOMContentLoaded', function() {
            let viewport = document.querySelector('meta[name="viewport"]');
            function preventZoom() {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
            }
            function allowZoom() {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0');
            }
            
            document.addEventListener('focusin', preventZoom);
            document.addEventListener('focusout', allowZoom);
        });
    </script>
</body>
</html>